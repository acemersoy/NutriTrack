<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adet Takibi - NutriTrack</title>
    <!-- Tema kontrol√º -->
    <script>
        (function() {
            const savedTheme = localStorage.getItem('nutritrack_theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="db.js" defer></script>
    <script src="main.js" defer></script>
    <script src="smooth-scroll.js" defer></script>
    <script src="swipe.js" defer></script>
    <script src="keyboard-handler.js" defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            overflow-x: hidden;
            position: relative;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #ffb3d9 0%, #ff91c7 50%, #ff6bb3 100%);
            min-height: 100vh;
            color: #333;
            padding-bottom: 100px;
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, #2d1a2d 0%, #3d1f3d 50%, #4d244d 100%);
            color: rgba(255, 255, 255, 0.87);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            box-sizing: border-box;
            overflow-x: hidden;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        /* Access Denied */
        .access-denied {
            background: white;
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            margin-top: 50px;
        }

        [data-theme="dark"] .access-denied {
            background: rgba(30, 30, 40, 0.95);
            color: rgba(255, 255, 255, 0.87);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-item {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 240, 245, 0.95));
            border-radius: 25px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(255, 105, 180, 0.3);
            border: 2px solid rgba(255, 182, 193, 0.5);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-item::before {
            content: '‚ú®';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2rem;
            opacity: 0.6;
            animation: sparkle 2s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
        }

        .stat-item:hover {
            transform: translateY(-5px) scale(1.02) rotate(1deg);
            box-shadow: 0 12px 35px rgba(255, 105, 180, 0.4);
        }

        [data-theme="dark"] .stat-item {
            background: linear-gradient(135deg, rgba(50, 30, 50, 0.95), rgba(60, 35, 60, 0.95));
            border-color: rgba(255, 182, 193, 0.3);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ff1493;
            margin-bottom: 8px;
        }

        [data-theme="dark"] .stat-value {
            color: #ff69b4;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        [data-theme="dark"] .stat-label {
            color: rgba(255, 255, 255, 0.60);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: rgba(255, 255, 255, 0.3);
            padding: 10px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        [data-theme="dark"] .tabs {
            background: rgba(0, 0, 0, 0.3);
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.5);
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            color: #ff1493;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.7);
            transform: translateY(-2px);
        }

        .tab.active {
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.4);
        }

        [data-theme="dark"] .tab {
            background: rgba(50, 30, 50, 0.5);
            color: #ff69b4;
        }

        [data-theme="dark"] .tab.active {
            background: linear-gradient(135deg, #ff69b4, #ff1493);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Content Cards */
        .content-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 240, 245, 0.95));
            border-radius: 30px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(255, 105, 180, 0.25);
            border: 2px solid rgba(255, 182, 193, 0.4);
            width: 100%;
            box-sizing: border-box;
            overflow-x: hidden;
        }

        [data-theme="dark"] .content-card {
            background: linear-gradient(135deg, rgba(50, 30, 50, 0.95), rgba(60, 35, 60, 0.95));
            border-color: rgba(255, 182, 193, 0.3);
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #ff1493;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        [data-theme="dark"] .section-title {
            color: #ff69b4;
        }

        /* Flow Buttons */
        .flow-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .flow-btn {
            background: linear-gradient(135deg, #fff5f8, #ffeef5);
            border: 2px solid rgba(255, 182, 193, 0.5);
            border-radius: 20px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
            color: #ff1493;
        }

        .flow-btn:hover {
            transform: scale(1.05) rotate(2deg);
            box-shadow: 0 5px 15px rgba(255, 105, 180, 0.3);
        }

        .flow-btn.active {
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            color: white;
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 5px 20px rgba(255, 105, 180, 0.5);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 5px 20px rgba(255, 105, 180, 0.5); }
            50% { box-shadow: 0 5px 25px rgba(255, 105, 180, 0.8), 0 0 15px rgba(255, 105, 180, 0.4); }
        }

        [data-theme="dark"] .flow-btn {
            background: rgba(50, 30, 50, 0.5);
            border-color: rgba(255, 182, 193, 0.3);
            color: #ff69b4;
        }

        .flow-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        /* Pain Levels */
        .pain-levels {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }

        .pain-level {
            flex: 1;
            min-width: 50px;
            background: linear-gradient(135deg, #fff5f8, #ffeef5);
            border: 2px solid rgba(255, 182, 193, 0.5);
            border-radius: 15px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #ff1493;
        }

        .pain-level:hover {
            transform: scale(1.1);
        }

        .pain-level.active {
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            color: white;
            border-color: rgba(255, 255, 255, 0.5);
        }

        /* Symptoms */
        .symptoms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
        }

        .symptom-item {
            background: linear-gradient(135deg, #fff5f8, #ffeef5);
            border: 2px solid rgba(255, 182, 193, 0.5);
            border-radius: 18px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #ff1493;
            font-size: 0.9rem;
        }

        .symptom-item:hover {
            transform: scale(1.05) rotate(1deg);
            box-shadow: 0 4px 12px rgba(255, 105, 180, 0.3);
        }

        .symptom-item.active {
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            color: white;
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.5);
            position: relative;
        }

        .symptom-item.active::after {
            content: '‚ú®';
            position: absolute;
            top: 5px;
            right: 8px;
            font-size: 0.8rem;
            animation: sparkle 1.5s ease-in-out infinite;
        }

        /* Save Button */
        .save-btn {
            width: 100%;
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 18px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(255, 105, 180, 0.4);
            margin-top: 20px;
        }

        .save-btn:hover {
            transform: translateY(-3px) scale(1.02) rotate(1deg);
            box-shadow: 0 8px 25px rgba(255, 105, 180, 0.5);
            background: linear-gradient(135deg, #ff1493, #ff69b4);
        }

        .save-btn:active {
            transform: translateY(-1px) scale(0.98);
        }

        /* Navbar Stats - Mini ƒ∞statistikler */
        .navbar-stats {
            display: flex;
            gap: 15px;
            align-items: center;
            padding: 0 20px;
            flex-wrap: wrap;
        }

        .navbar-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 15px;
            background: linear-gradient(135deg, rgba(255, 240, 245, 0.9), rgba(255, 228, 235, 0.9));
            border-radius: 15px;
            border: 2px solid rgba(255, 182, 193, 0.5);
            box-shadow: 0 3px 10px rgba(255, 105, 180, 0.3);
            min-width: 70px;
            transition: all 0.3s ease;
        }

        .navbar-stat:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 105, 180, 0.4);
        }

        .navbar-stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: #ff1493;
            line-height: 1.2;
        }

        .navbar-stat-label {
            font-size: 0.7rem;
            color: #666;
            text-align: center;
            margin-top: 3px;
        }

        [data-theme="dark"] .navbar-stat {
            background: linear-gradient(135deg, rgba(50, 30, 50, 0.9), rgba(60, 35, 60, 0.9));
            border-color: rgba(255, 182, 193, 0.4);
        }

        [data-theme="dark"] .navbar-stat-value {
            color: #ff69b4;
        }

        [data-theme="dark"] .navbar-stat-label {
            color: rgba(255, 255, 255, 0.60);
        }

        @media (max-width: 768px) {
            .navbar-stats {
                display: none;
            }
        }

        /* Responsive Calendar */
        @media (max-width: 1024px) {
            .container {
                padding: 15px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px 10px;
                width: 100%;
                max-width: 100%;
            }

            .content-card {
                padding: 20px 15px;
            }

            .calendar-container {
                margin-top: 15px;
                width: 100%;
            }

            .calendar-header {
                margin-bottom: 15px;
                flex-wrap: wrap;
                gap: 10px;
            }

            .calendar-nav-btn {
                padding: 10px 14px;
                font-size: 1rem;
                border-radius: 15px;
            }

            .calendar-month {
                font-size: 1.1rem;
                text-align: center;
                width: 100%;
                order: -1;
            }

            .calendar-grid {
                gap: 6px;
                width: 100%;
                max-width: 100%;
            }

            .calendar-day-header {
                padding: 8px 4px;
                font-size: 0.75rem;
            }

            .calendar-day {
                border-radius: 12px;
                font-size: 0.85rem;
                border-width: 1.5px;
            }

            .calendar-day.today {
                border-width: 2px;
                font-size: 0.9rem;
            }

            .calendar-day.today::before {
                font-size: 0.6rem;
                top: 1px;
                right: 3px;
            }

            /* Renk a√ßƒ±klamalarƒ± mobilde daha kompakt */
            .calendar-container > div:last-child {
                margin-top: 15px !important;
                padding: 15px !important;
            }

            .calendar-container > div:last-child > div:first-child {
                font-size: 0.9rem !important;
                margin-bottom: 12px !important;
            }

            .calendar-container > div:last-child > div:last-child {
                flex-direction: column !important;
                gap: 10px !important;
            }

            .calendar-container > div:last-child > div:last-child > div {
                width: 100% !important;
                padding: 10px 12px !important;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px 8px;
                width: 100%;
                max-width: 100%;
            }

            .content-card {
                padding: 15px 10px;
            }

            .calendar-container {
                width: 100%;
                max-width: 100%;
            }

            .header h1 {
                font-size: 2rem;
            }

            .header p {
                font-size: 1rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .stat-item {
                padding: 18px;
                border-radius: 20px;
            }

            .stat-value {
                font-size: 2rem;
            }

            .stat-label {
                font-size: 0.8rem;
            }

            .tabs {
                gap: 8px;
                padding: 8px;
            }

            .tab {
                min-width: 100px;
                padding: 10px 12px;
                font-size: 0.8rem;
            }

            .content-card {
                padding: 20px;
                border-radius: 25px;
            }

            .calendar-container {
                margin-top: 10px;
            }

            .calendar-header {
                margin-bottom: 12px;
            }

            .calendar-nav-btn {
                padding: 8px 12px;
                font-size: 0.9rem;
                border-radius: 12px;
            }

            .calendar-month {
                font-size: 1rem;
            }

            .calendar-grid {
                gap: 4px;
                width: 100%;
                max-width: 100%;
            }

            .calendar-day-header {
                padding: 6px 2px;
                font-size: 0.7rem;
            }

            .calendar-day {
                border-radius: 10px;
                font-size: 0.8rem;
                min-height: 35px;
            }

            .calendar-day.today {
                font-size: 0.85rem;
                border-width: 2px;
            }

            .calendar-day.today::before {
                font-size: 0.5rem;
            }

            /* Renk a√ßƒ±klamalarƒ± √ßok k√º√ß√ºk ekranlarda */
            .calendar-container > div:last-child {
                margin-top: 12px !important;
                padding: 12px !important;
                border-radius: 12px !important;
            }

            .calendar-container > div:last-child > div:first-child {
                font-size: 0.85rem !important;
                margin-bottom: 10px !important;
            }

            .calendar-container > div:last-child > div:last-child {
                flex-direction: column !important;
                gap: 8px !important;
            }

            .calendar-container > div:last-child > div:last-child > div {
                padding: 8px 10px !important;
                border-radius: 8px !important;
                width: 100% !important;
            }

            .calendar-container > div:last-child > div:last-child > div > div:first-child {
                width: 20px !important;
                height: 20px !important;
            }

            .calendar-container > div:last-child > div:last-child > div > div:last-child > div:first-child {
                font-size: 0.85rem !important;
            }

            .calendar-container > div:last-child > div:last-child > div > div:last-child > div:last-child {
                font-size: 0.7rem !important;
            }

            .flow-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .flow-btn {
                padding: 12px;
            }

            .pain-levels {
                gap: 6px;
            }

            .pain-level {
                min-width: 40px;
                padding: 10px;
                font-size: 0.9rem;
            }

            .symptoms-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .symptom-item {
                padding: 12px;
                font-size: 0.85rem;
            }

            .history-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
                padding: 15px;
            }

            .back-btn, .theme-toggle-btn {
                width: 45px;
                height: 45px;
                font-size: 1.1rem;
            }
        }

        /* Calendar */
        .calendar-container {
            margin-top: 20px;
            width: 100%;
            box-sizing: border-box;
            overflow-x: hidden;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav-btn {
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .calendar-nav-btn:hover {
            background: linear-gradient(135deg, #ff1493, #ff69b4);
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 6px 20px rgba(255, 105, 180, 0.4);
            animation: bounce 0.5s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1.1) rotate(5deg); }
            50% { transform: scale(1.15) rotate(8deg); }
        }

        .calendar-month {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1a1a1a;
        }

        [data-theme="dark"] .calendar-month {
            color: rgba(255, 255, 255, 0.87);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            width: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            padding: 10px;
            color: #666;
            font-size: 0.9rem;
        }

        [data-theme="dark"] .calendar-day-header {
            color: rgba(255, 255, 255, 0.60);
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            background: linear-gradient(135deg, #fff5f8, #ffeef5);
            color: #ff1493;
            border: 2px solid rgba(255, 182, 193, 0.3);
            box-shadow: 0 2px 8px rgba(255, 182, 193, 0.2);
            position: relative;
            overflow: hidden;
        }

        .calendar-day::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: rotate(45deg);
            transition: all 0.5s ease;
            opacity: 0;
        }

        .calendar-day:hover::before {
            opacity: 1;
            animation: shine 1.5s ease-in-out infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .calendar-day:hover {
            transform: scale(1.05) rotate(2deg);
            box-shadow: 0 4px 15px rgba(255, 182, 193, 0.5),
                        0 0 20px rgba(255, 105, 180, 0.3),
                        inset 0 0 15px rgba(255, 255, 255, 0.4);
        }

        [data-theme="dark"] .calendar-day {
            background: linear-gradient(135deg, rgba(255, 105, 180, 0.1), rgba(255, 20, 147, 0.05));
            color: #ffb6c1;
            border-color: rgba(255, 182, 193, 0.4);
        }

        .calendar-day.other-month {
            opacity: 0.4;
            background: rgba(255, 182, 193, 0.1);
        }

        .calendar-day.today {
            background: linear-gradient(135deg, #ff69b4, #ff1493, #ff69b4);
            background-size: 200% 200%;
            color: white;
            font-weight: 800;
            border: 3px solid #fff;
            box-shadow: 0 4px 20px rgba(255, 105, 180, 0.7),
                        0 0 40px rgba(255, 105, 180, 0.5),
                        0 0 0 3px rgba(255, 105, 180, 0.4),
                        inset 0 0 25px rgba(255, 255, 255, 0.4);
            animation: todayPulse 2s ease-in-out infinite, gradientShift 3s ease infinite;
            position: relative;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .calendar-day.today::before {
            content: '‚ú®';
            position: absolute;
            top: 2px;
            right: 4px;
            font-size: 0.7rem;
            animation: sparkle 1s ease-in-out infinite;
        }

        @keyframes todayPulse {
            0%, 100% { 
                box-shadow: 0 4px 20px rgba(255, 105, 180, 0.7),
                            0 0 40px rgba(255, 105, 180, 0.5),
                            0 0 0 3px rgba(255, 105, 180, 0.4),
                            inset 0 0 25px rgba(255, 255, 255, 0.4);
            }
            50% { 
                box-shadow: 0 4px 30px rgba(255, 105, 180, 0.9),
                            0 0 50px rgba(255, 105, 180, 0.7),
                            0 0 0 5px rgba(255, 105, 180, 0.6),
                            inset 0 0 30px rgba(255, 255, 255, 0.5);
            }
        }

        /* Adet (Period) - Kƒ±rmƒ±zƒ±/Pembe - Shiny Glowy */
        .calendar-day.period {
            background: linear-gradient(135deg, #ff6b9d, #ff1493, #ff6b9d);
            background-size: 200% 200%;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 20px rgba(255, 107, 157, 0.6),
                        0 0 30px rgba(255, 107, 157, 0.4),
                        inset 0 0 20px rgba(255, 255, 255, 0.3);
            font-weight: 700;
            animation: periodGlow 3s ease-in-out infinite;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        @keyframes periodGlow {
            0%, 100% { 
                box-shadow: 0 4px 20px rgba(255, 107, 157, 0.6),
                            0 0 30px rgba(255, 107, 157, 0.4),
                            inset 0 0 20px rgba(255, 255, 255, 0.3);
            }
            50% { 
                box-shadow: 0 4px 25px rgba(255, 107, 157, 0.8),
                            0 0 40px rgba(255, 107, 157, 0.6),
                            inset 0 0 25px rgba(255, 255, 255, 0.4);
            }
        }

        .calendar-day.period::before {
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.5), transparent);
        }

        [data-theme="dark"] .calendar-day.period {
            box-shadow: 0 4px 25px rgba(255, 107, 157, 0.7),
                        0 0 35px rgba(255, 107, 157, 0.5),
                        inset 0 0 20px rgba(255, 255, 255, 0.2);
        }

        /* Yumurtlama (Ovulation) - Ye≈üil - Shiny Glowy */
        .calendar-day.ovulation {
            background: linear-gradient(135deg, #4ade80, #22c55e, #4ade80);
            background-size: 200% 200%;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 20px rgba(74, 222, 128, 0.6),
                        0 0 30px rgba(74, 222, 128, 0.4),
                        inset 0 0 20px rgba(255, 255, 255, 0.3);
            font-weight: 700;
            animation: ovulationGlow 3s ease-in-out infinite;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        @keyframes ovulationGlow {
            0%, 100% { 
                box-shadow: 0 4px 20px rgba(74, 222, 128, 0.6),
                            0 0 30px rgba(74, 222, 128, 0.4),
                            inset 0 0 20px rgba(255, 255, 255, 0.3);
            }
            50% { 
                box-shadow: 0 4px 25px rgba(74, 222, 128, 0.8),
                            0 0 40px rgba(74, 222, 128, 0.6),
                            inset 0 0 25px rgba(255, 255, 255, 0.4);
            }
        }

        .calendar-day.ovulation::before {
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.5), transparent);
        }

        [data-theme="dark"] .calendar-day.ovulation {
            box-shadow: 0 4px 25px rgba(74, 222, 128, 0.7),
                        0 0 35px rgba(74, 222, 128, 0.5),
                        inset 0 0 20px rgba(255, 255, 255, 0.2);
        }

        /* Doƒüurganlƒ±k Penceresi (Fertile Window) - Turuncu/Sarƒ± - Shiny Glowy */
        .calendar-day.fertile {
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #fbbf24);
            background-size: 200% 200%;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 20px rgba(251, 191, 36, 0.6),
                        0 0 30px rgba(251, 191, 36, 0.4),
                        inset 0 0 20px rgba(255, 255, 255, 0.3);
            font-weight: 700;
            animation: fertileGlow 3s ease-in-out infinite;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        @keyframes fertileGlow {
            0%, 100% { 
                box-shadow: 0 4px 20px rgba(251, 191, 36, 0.6),
                            0 0 30px rgba(251, 191, 36, 0.4),
                            inset 0 0 20px rgba(255, 255, 255, 0.3);
            }
            50% { 
                box-shadow: 0 4px 25px rgba(251, 191, 36, 0.8),
                            0 0 40px rgba(251, 191, 36, 0.6),
                            inset 0 0 25px rgba(255, 255, 255, 0.4);
            }
        }

        .calendar-day.fertile::before {
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.5), transparent);
        }

        [data-theme="dark"] .calendar-day.fertile {
            box-shadow: 0 4px 25px rgba(251, 191, 36, 0.7),
                        0 0 35px rgba(251, 191, 36, 0.5),
                        inset 0 0 20px rgba(255, 255, 255, 0.2);
        }

        /* History */
        .history-item {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.7), rgba(255, 240, 245, 0.7));
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid rgba(255, 182, 193, 0.4);
            transition: all 0.3s ease;
        }

        .history-item:hover {
            transform: translateX(5px) scale(1.02);
            box-shadow: 0 5px 15px rgba(255, 105, 180, 0.3);
            border-color: rgba(255, 182, 193, 0.6);
        }

        [data-theme="dark"] .history-item {
            background: rgba(50, 30, 50, 0.7);
            border-color: rgba(255, 182, 193, 0.3);
        }

        .history-date {
            font-size: 1.1rem;
            font-weight: 700;
            color: #ff1493;
            margin-bottom: 5px;
        }

        .history-info {
            font-size: 0.9rem;
            color: #666;
        }

        [data-theme="dark"] .history-info {
            color: rgba(255, 255, 255, 0.60);
        }

        /* Nutrition Tips */
        .nutrition-tip {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(255, 240, 245, 0.8));
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #ff69b4;
            transition: all 0.3s ease;
        }

        .nutrition-tip:hover {
            transform: translateX(5px) scale(1.02);
            box-shadow: 0 5px 15px rgba(255, 105, 180, 0.2);
            border-left-width: 7px;
        }

        [data-theme="dark"] .nutrition-tip {
            background: rgba(50, 30, 50, 0.8);
            border-left-color: #ff69b4;
        }

        .tip-title {
            font-weight: 700;
            color: #ff1493;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .tip-text {
            color: #666;
            font-size: 0.95rem;
        }

        [data-theme="dark"] .tip-text {
            color: rgba(255, 255, 255, 0.70);
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(255, 105, 180, 0.4);
            z-index: 10000;
            animation: slideIn 0.3s ease;
            font-weight: 600;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Back Button */
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            color: #ff1493;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .back-btn:hover {
            transform: scale(1.1) rotate(-10deg);
            background: white;
        }

        [data-theme="dark"] .back-btn {
            background: rgba(50, 30, 50, 0.9);
            color: #ff69b4;
        }

        /* Theme Toggle Button */
        .theme-toggle-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ffb6c1, #ff91c7);
            border: 2px solid rgba(255, 255, 255, 0.5);
            padding: 12px 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.3rem;
            color: white;
            box-shadow: 0 6px 20px rgba(255, 105, 180, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle-btn:hover {
            transform: scale(1.1) rotate(10deg);
            background: linear-gradient(135deg, #ff91c7, #ff69b4);
            box-shadow: 0 8px 25px rgba(255, 105, 180, 0.5);
        }

        [data-theme="dark"] .theme-toggle-btn {
            background: linear-gradient(135deg, rgba(255, 105, 180, 0.9), rgba(255, 20, 147, 0.9));
            border-color: rgba(255, 182, 193, 0.6);
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.location.href='profile.html'">
        <i class="fas fa-arrow-left"></i>
    </button>
    <button class="theme-toggle-btn" onclick="toggleTheme()" title="Tema Deƒüi≈ütir">
        <i class="fas fa-moon" id="themeIcon"></i>
    </button>

    <div class="container">
        <div class="header">
            <h1>üå∏ Adet Takibi üíï</h1>
            <p>‚ú® D√∂ng√ºn√ºz√º takip edin, saƒülƒ±ƒüƒ±nƒ±zƒ± y√∂netin ‚ú®</p>
        </div>

        <!-- Access Control -->
        <div id="accessDenied" class="access-denied" style="display: none;">
            <i class="fas fa-lock" style="font-size: 3rem; color: #ff69b4; margin-bottom: 20px;"></i>
            <h2 style="color: #ff1493; margin-bottom: 15px;">Eri≈üim Kƒ±sƒ±tlƒ±</h2>
            <p style="color: #666; margin-bottom: 20px;">Bu sayfa sadece kadƒ±n kullanƒ±cƒ±lar i√ßin tasarlanmƒ±≈ütƒ±r.</p>
            <button onclick="window.location.href='profile.html'" style="background: linear-gradient(135deg, #ff69b4, #ff1493); color: white; border: none; padding: 12px 30px; border-radius: 15px; cursor: pointer; font-weight: 600;">
                Profil Sayfasƒ±na D√∂n
            </button>
        </div>

        <!-- Main Content -->
        <div id="mainContent" style="display: none;">
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="daysUntilPeriod">--</div>
                    <div class="stat-label">üíñ Sonraki Adete Kalan G√ºn</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="cycleLength">28</div>
                    <div class="stat-label">üíñ Ortalama D√∂ng√º Uzunluƒüu</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="ovulationDay">--</div>
                    <div class="stat-label">üíñ Yumurtlama G√ºn√º</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="cycleRegularity">--</div>
                    <div class="stat-label">üíñ D√ºzenlilik Skoru</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                    <button class="tab active" onclick="switchTab('daily')">
                    ‚úèÔ∏è G√ºnl√ºk Takip
                </button>
                <button class="tab" onclick="switchTab('calendar')">
                    üìÖ Takvim
                </button>
                <button class="tab" onclick="switchTab('history')">
                    üìà Ge√ßmi≈ü
                </button>
                <button class="tab" onclick="switchTab('nutrition')">
                    üçì Beslenme √ñnerileri ‚≠ê
                </button>
            </div>

            <!-- Daily Tracking Tab -->
            <div id="dailyTab" class="tab-content active">
                <div class="content-card">
                    <label class="section-title">
                        üíß Adet Durumu
                    </label>
                    <div class="flow-buttons">
                        <button class="flow-btn" onclick="setFlow('none')">
                            <div class="flow-icon">‚ùå</div>
                            <div>Yok</div>
                        </button>
                        <button class="flow-btn" onclick="setFlow('light')">
                            <div class="flow-icon">üíß</div>
                            <div>Hafif</div>
                        </button>
                        <button class="flow-btn" onclick="setFlow('medium')">
                            <div class="flow-icon">üíßüíß</div>
                            <div>Orta</div>
                        </button>
                        <button class="flow-btn" onclick="setFlow('heavy')">
                            <div class="flow-icon">üíßüíßüíß</div>
                            <div>Yoƒüun</div>
                        </button>
                    </div>

                    <label class="section-title">
                        üò£ Aƒürƒ± Seviyesi (0-10)
                    </label>
                    <div class="pain-levels">
                        <div class="pain-level" onclick="setPain(0)">0</div>
                        <div class="pain-level" onclick="setPain(1)">1</div>
                        <div class="pain-level" onclick="setPain(2)">2</div>
                        <div class="pain-level" onclick="setPain(3)">3</div>
                        <div class="pain-level" onclick="setPain(4)">4</div>
                        <div class="pain-level" onclick="setPain(5)">5</div>
                        <div class="pain-level" onclick="setPain(6)">6</div>
                        <div class="pain-level" onclick="setPain(7)">7</div>
                        <div class="pain-level" onclick="setPain(8)">8</div>
                        <div class="pain-level" onclick="setPain(9)">9</div>
                        <div class="pain-level" onclick="setPain(10)">10</div>
                    </div>

                    <label class="section-title">
                        üå∏ Semptomlar
                    </label>
                    <div class="symptoms-grid">
                        <div class="symptom-item" onclick="toggleSymptom('mood')">Ruh Hali</div>
                        <div class="symptom-item" onclick="toggleSymptom('bloating')">≈ûi≈ükinlik</div>
                        <div class="symptom-item" onclick="toggleSymptom('headache')">Ba≈ü Aƒürƒ±sƒ±</div>
                        <div class="symptom-item" onclick="toggleSymptom('fatigue')">Yorgunluk</div>
                        <div class="symptom-item" onclick="toggleSymptom('cramps')">Kramp</div>
                        <div class="symptom-item" onclick="toggleSymptom('acne')">Sivilce</div>
                        <div class="symptom-item" onclick="toggleSymptom('cravings')">A≈üerme</div>
                        <div class="symptom-item" onclick="toggleSymptom('nausea')">Mide Bulantƒ±sƒ±</div>
                    </div>

                    <button class="save-btn" onclick="saveDailyTracking()">
                        üíæ Kaydet ‚ú®
                    </button>
                </div>
            </div>

            <!-- Calendar Tab -->
            <div id="calendarTab" class="tab-content">
                <div class="content-card">
                    <div class="calendar-container">
                        <div class="calendar-header">
                            <button class="calendar-nav-btn" onclick="changeMonth(-1)">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <div class="calendar-month" id="calendarMonth"></div>
                            <button class="calendar-nav-btn" onclick="changeMonth(1)">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div id="calendarGrid" class="calendar-grid"></div>
                        <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, rgba(255, 182, 193, 0.2), rgba(255, 192, 203, 0.15)); border-radius: 15px; border: 2px solid rgba(255, 182, 193, 0.3);">
                            <div style="text-align: center; margin-bottom: 15px; font-weight: 600; color: #ff1493; font-size: 1rem;">
                                üìÖ Renk A√ßƒ±klamalarƒ±
                            </div>
                            <div style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;">
                                <div style="display: flex; align-items: center; gap: 10px; padding: 8px 15px; background: rgba(255, 255, 255, 0.5); border-radius: 10px;">
                                    <div style="width: 24px; height: 24px; background: #ff6b9d; border-radius: 6px; box-shadow: 0 2px 6px rgba(255, 107, 157, 0.4);"></div>
                                    <div>
                                        <div style="font-weight: 600; color: #ff1493; font-size: 0.95rem;">Adet (Period)</div>
                                        <div style="font-size: 0.8rem; color: #666; margin-top: 2px;">Menstruasyon d√∂nemi</div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px; padding: 8px 15px; background: rgba(255, 255, 255, 0.5); border-radius: 10px;">
                                    <div style="width: 24px; height: 24px; background: #4ade80; border-radius: 6px; box-shadow: 0 2px 6px rgba(74, 222, 128, 0.4);"></div>
                                    <div>
                                        <div style="font-weight: 600; color: #ff1493; font-size: 0.95rem;">Yumurtlama (Ovulation)</div>
                                        <div style="font-size: 0.8rem; color: #666; margin-top: 2px;">Yumurta salƒ±nƒ±m g√ºn√º</div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px; padding: 8px 15px; background: rgba(255, 255, 255, 0.5); border-radius: 10px;">
                                    <div style="width: 24px; height: 24px; background: #fbbf24; border-radius: 6px; box-shadow: 0 2px 6px rgba(251, 191, 36, 0.4);"></div>
                                    <div>
                                        <div style="font-weight: 600; color: #ff1493; font-size: 0.95rem;">Doƒüurganlƒ±k (Fertile)</div>
                                        <div style="font-size: 0.8rem; color: #666; margin-top: 2px;">Doƒüurganlƒ±k penceresi</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div id="historyTab" class="tab-content">
                <div class="content-card">
                    <h2 class="section-title">
                        <i class="fas fa-history"></i> D√∂ng√º Ge√ßmi≈üi
                    </h2>
                    <div id="historyList"></div>
                </div>
            </div>

            <!-- Nutrition Tab -->
            <div id="nutritionTab" class="tab-content">
                <div class="content-card">
                    <h2 class="section-title">
                        <i class="fas fa-apple-alt"></i> üçì Beslenme √ñnerileri
                    </h2>
                    <div id="nutritionTips"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navigation">
        <div class="navbar-stats">
            <div class="navbar-stat">
                <div class="navbar-stat-value" id="navbarDaysUntil">--</div>
                <div class="navbar-stat-label">Adete Kalan</div>
            </div>
            <div class="navbar-stat">
                <div class="navbar-stat-value" id="navbarOvulation">--</div>
                <div class="navbar-stat-label">Yumurtlama</div>
            </div>
        </div>
        <a href="index.html" class="nav-item"><i class="fas fa-home"></i></a>
        <a href="nutrition.html" class="nav-item"><i class="fas fa-utensils"></i></a>
        <a href="progress.html" class="nav-item"><i class="fas fa-chart-line"></i></a>
        <a href="profile.html" class="nav-item"><i class="fas fa-user"></i></a>
    </nav>

    <script>
        // Global variables
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        let userData = {};
        let periodHistory = [];
        let todayTracking = {
            flow: 'none',
            pain: null,
            symptoms: []
        };

        // Check access on load
        document.addEventListener('DOMContentLoaded', function() {
            userData = JSON.parse(localStorage.getItem('nutritrack_user') || '{}');
            periodHistory = JSON.parse(localStorage.getItem('nutritrack_period_history') || '[]');
            
            // Check if user is female
            if (userData.gender !== 'female') {
                document.getElementById('accessDenied').style.display = 'block';
                document.getElementById('mainContent').style.display = 'none';
                return;
            }

            document.getElementById('accessDenied').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';

            // Initialize
            updateStats();
            loadTodayTracking();
            renderCalendar();
            loadHistory();
            updateNutritionTips();
            updateThemeIcon();
        });

        // Update stats
        function updateStats() {
            if (!userData.lastPeriod) {
                document.getElementById('daysUntilPeriod').textContent = '--';
                document.getElementById('ovulationDay').textContent = '--';
                const navbarDaysUntil = document.getElementById('navbarDaysUntil');
                const navbarOvulation = document.getElementById('navbarOvulation');
                if (navbarDaysUntil) navbarDaysUntil.textContent = '--';
                if (navbarOvulation) navbarOvulation.textContent = '--';
                return;
            }

            const lastPeriod = new Date(userData.lastPeriod);
            const cycleLength = userData.cycleLength || 28;
            const nextPeriod = new Date(lastPeriod);
            nextPeriod.setDate(nextPeriod.getDate() + cycleLength);
            
            const today = new Date();
            const daysUntil = Math.ceil((nextPeriod - today) / (1000 * 60 * 60 * 24));
            
            document.getElementById('daysUntilPeriod').textContent = daysUntil > 0 ? daysUntil : 'Ba≈üladƒ±';
            document.getElementById('cycleLength').textContent = cycleLength;
            
            // Ovulation day (Day 14 of cycle: lastPeriod + 14 days)
            const ovulationDate = new Date(lastPeriod);
            ovulationDate.setDate(ovulationDate.getDate() + 14);
            const daysUntilOvulation = Math.ceil((ovulationDate - today) / (1000 * 60 * 60 * 24));
            document.getElementById('ovulationDay').textContent = daysUntilOvulation > 0 ? daysUntilOvulation + ' g√ºn' : 'Ge√ßti';
            
            // Update navbar stats
            const navbarDaysUntil = document.getElementById('navbarDaysUntil');
            const navbarOvulation = document.getElementById('navbarOvulation');
            if (navbarDaysUntil) {
                navbarDaysUntil.textContent = daysUntil > 0 ? daysUntil : '‚ú®';
            }
            if (navbarOvulation) {
                navbarOvulation.textContent = daysUntilOvulation > 0 ? daysUntilOvulation : '‚ú®';
            }
            
            // Calculate regularity score
            if (periodHistory.length >= 3) {
                const cycles = [];
                for (let i = 1; i < periodHistory.length; i++) {
                    const prev = new Date(periodHistory[i-1].startDate);
                    const curr = new Date(periodHistory[i].startDate);
                    const diff = Math.ceil((curr - prev) / (1000 * 60 * 60 * 24));
                    cycles.push(diff);
                }
                const avg = cycles.reduce((a, b) => a + b, 0) / cycles.length;
                const variance = cycles.reduce((sum, cycle) => sum + Math.pow(cycle - avg, 2), 0) / cycles.length;
                const regularity = Math.max(0, Math.min(100, 100 - (variance * 2)));
                document.getElementById('cycleRegularity').textContent = Math.round(regularity) + '%';
            } else {
                document.getElementById('cycleRegularity').textContent = '--';
            }
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            if (tabName === 'calendar') {
                renderCalendar();
            } else if (tabName === 'history') {
                loadHistory();
            } else if (tabName === 'nutrition') {
                updateNutritionTips();
            }
        }

        // Flow selection
        function setFlow(flow) {
            todayTracking.flow = flow;
            document.querySelectorAll('.flow-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.flow-btn').classList.add('active');
        }

        // Pain selection
        function setPain(level) {
            todayTracking.pain = level;
            document.querySelectorAll('.pain-level').forEach(levelEl => levelEl.classList.remove('active'));
            event.target.closest('.pain-level').classList.add('active');
        }

        // Symptom toggle
        function toggleSymptom(symptom) {
            const index = todayTracking.symptoms.indexOf(symptom);
            if (index > -1) {
                todayTracking.symptoms.splice(index, 1);
                event.target.closest('.symptom-item').classList.remove('active');
            } else {
                todayTracking.symptoms.push(symptom);
                event.target.closest('.symptom-item').classList.add('active');
            }
        }

        // Save daily tracking
        function saveDailyTracking() {
            const today = new Date().toISOString().split('T')[0];
            
            // Reload periodHistory from localStorage to ensure we have latest data
            periodHistory = JSON.parse(localStorage.getItem('nutritrack_period_history') || '[]');
            
            // Check if period started
            if (todayTracking.flow !== 'none' && todayTracking.flow !== null) {
                // Check if this is a new period start
                const lastPeriod = periodHistory.length > 0 ? new Date(periodHistory[periodHistory.length - 1].startDate) : null;
                const daysSinceLastPeriod = lastPeriod ? Math.ceil((new Date() - lastPeriod) / (1000 * 60 * 60 * 24)) : 999;
                
                // If no last period or more than 20 days since last period, it's a new period
                if (!lastPeriod || daysSinceLastPeriod > 20) {
                    // Calculate cycle length if we have previous period
                    let cycleLength = null;
                    if (lastPeriod && periodHistory.length > 0) {
                        const prevStart = new Date(periodHistory[periodHistory.length - 1].startDate);
                        cycleLength = Math.ceil((new Date() - prevStart) / (1000 * 60 * 60 * 24));
                    }
                    
                    // New period started
                    periodHistory.push({
                        startDate: today,
                        endDate: null,
                        cycleLength: cycleLength,
                        symptoms: todayTracking.symptoms || [],
                        flow: todayTracking.flow,
                        pain: todayTracking.pain
                    });
                } else {
                    // Update existing period with today's data
                    const lastPeriodIndex = periodHistory.length - 1;
                    if (lastPeriodIndex >= 0) {
                        periodHistory[lastPeriodIndex].symptoms = todayTracking.symptoms || [];
                        periodHistory[lastPeriodIndex].flow = todayTracking.flow;
                        periodHistory[lastPeriodIndex].pain = todayTracking.pain;
                    }
                }
            }
            
            // Save tracking data
            let dailyTracking = JSON.parse(localStorage.getItem('nutritrack_daily_tracking') || '{}');
            dailyTracking[today] = {
                flow: todayTracking.flow,
                pain: todayTracking.pain,
                symptoms: todayTracking.symptoms || []
            };
            localStorage.setItem('nutritrack_daily_tracking', JSON.stringify(dailyTracking));
            
            // Save period history
            localStorage.setItem('nutritrack_period_history', JSON.stringify(periodHistory));
            
            // Reload periodHistory to ensure sync
            periodHistory = JSON.parse(localStorage.getItem('nutritrack_period_history') || '[]');
            
            showNotification('G√ºnl√ºk takip kaydedildi! üíï');
            updateStats();
            loadHistory(); // Reload history display
            renderCalendar();
        }

        // Load today's tracking
        function loadTodayTracking() {
            const today = new Date().toISOString().split('T')[0];
            const dailyTracking = JSON.parse(localStorage.getItem('nutritrack_daily_tracking') || '{}');
            
            if (dailyTracking[today]) {
                todayTracking = dailyTracking[today];
                
                // Restore UI state
                if (todayTracking.flow) {
                    document.querySelectorAll('.flow-btn').forEach(btn => {
                        if (btn.textContent.includes(todayTracking.flow === 'light' ? 'Hafif' : 
                            todayTracking.flow === 'medium' ? 'Orta' : 
                            todayTracking.flow === 'heavy' ? 'Yoƒüun' : 'Yok')) {
                            btn.classList.add('active');
                        }
                    });
                }
                
                if (todayTracking.pain !== null) {
                    document.querySelectorAll('.pain-level')[todayTracking.pain].classList.add('active');
                }
                
                todayTracking.symptoms.forEach(symptom => {
                    document.querySelectorAll('.symptom-item').forEach(item => {
                        if (item.textContent.includes(getSymptomLabel(symptom))) {
                            item.classList.add('active');
                        }
                    });
                });
            }
        }

        function getSymptomLabel(symptom) {
            const labels = {
                'mood': 'Ruh Hali',
                'bloating': '≈ûi≈ükinlik',
                'headache': 'Ba≈ü Aƒürƒ±sƒ±',
                'fatigue': 'Yorgunluk',
                'cramps': 'Kramp',
                'acne': 'Sivilce',
                'cravings': 'A≈üerme',
                'nausea': 'Mide Bulantƒ±sƒ±'
            };
            return labels[symptom] || symptom;
        }

        // Calendar functions
        function renderCalendar() {
            // Reload periodHistory from localStorage to ensure we have latest data
            periodHistory = JSON.parse(localStorage.getItem('nutritrack_period_history') || '[]');
            
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            // Adjust starting day (Monday = 0, Sunday = 6)
            const adjustedStart = startingDayOfWeek === 0 ? 6 : startingDayOfWeek - 1;
            
            const monthNames = ['Ocak', '≈ûubat', 'Mart', 'Nisan', 'Mayƒ±s', 'Haziran', 
                              'Temmuz', 'Aƒüustos', 'Eyl√ºl', 'Ekim', 'Kasƒ±m', 'Aralƒ±k'];
            
            document.getElementById('calendarMonth').textContent = monthNames[currentMonth] + ' ' + currentYear;
            
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            // Day headers
            const dayHeaders = ['Pzt', 'Sal', '√áar', 'Per', 'Cum', 'Cmt', 'Paz'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                grid.appendChild(header);
            });
            
            // Empty cells for days before month starts
            for (let i = 0; i < adjustedStart; i++) {
                const empty = document.createElement('div');
                empty.className = 'calendar-day other-month';
                grid.appendChild(empty);
            }
            
            // Days of month
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                dayEl.textContent = day;
                
                const date = new Date(currentYear, currentMonth, day);
                
                // Check if today
                if (date.toDateString() === today.toDateString()) {
                    dayEl.classList.add('today');
                }
                
                // Check if period day (highest priority)
                if (isPeriodDay(date)) {
                    dayEl.classList.add('period');
                } else if (isOvulationDay(date)) {
                    // Check if ovulation day (second priority)
                    dayEl.classList.add('ovulation');
                } else if (isFertileDay(date)) {
                    // Check if fertile window (lowest priority)
                    dayEl.classList.add('fertile');
                }
                
                grid.appendChild(dayEl);
            }
        }

        // Get cycle day (Day 1 = lastPeriod)
        function getCycleDay(date) {
            if (!userData.lastPeriod) return null;
            
            const lastPeriod = new Date(userData.lastPeriod);
            const checkDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());
            const lpDate = new Date(lastPeriod.getFullYear(), lastPeriod.getMonth(), lastPeriod.getDate());
            
            const diff = Math.floor((checkDate - lpDate) / (1000 * 60 * 60 * 24));
            return diff < 0 ? null : diff + 1; // Day 1 = lastPeriod
        }

        function isPeriodDay(date) {
            // First check periodHistory for actual recorded periods
            periodHistory = JSON.parse(localStorage.getItem('nutritrack_period_history') || '[]');
            
            if (periodHistory && periodHistory.length > 0) {
                for (let period of periodHistory) {
                    const startDate = new Date(period.startDate);
                    const endDate = period.endDate ? new Date(period.endDate) : new Date(startDate);
                    endDate.setDate(endDate.getDate() + 5); // Default 5 days if no end date
                    
                    // Normalize dates to compare only dates (ignore time)
                    const checkDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());
                    const periodStart = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate());
                    const periodEnd = new Date(endDate.getFullYear(), endDate.getMonth(), endDate.getDate());
                    
                    if (checkDate >= periodStart && checkDate <= periodEnd) {
                        return true;
                    }
                }
            }
            
            // Fallback to calculated period if no history
            if (!userData.lastPeriod) return false;
            
            const cycleDay = getCycleDay(date);
            if (!cycleDay) return false;
            
            // Period typically lasts 5 days (Day 1-5)
            return cycleDay >= 1 && cycleDay <= 5;
        }

        function isOvulationDay(date) {
            if (!userData.lastPeriod) return false;
            
            const cycleDay = getCycleDay(date);
            if (!cycleDay) return false;
            
            // Ovulation = Day 14 of cycle
            return cycleDay === 14;
        }

        function isFertileDay(date) {
            if (!userData.lastPeriod) return false;
            
            // Don't show fertile if it's already a period or ovulation day
            if (isPeriodDay(date) || isOvulationDay(date)) return false;
            
            const cycleDay = getCycleDay(date);
            if (!cycleDay) return false;
            
            // Fertile window: 5 days before ovulation + ovulation day (Day 9-14)
            // But ovulation day is handled separately, so fertile = Day 9-13
            return cycleDay >= 9 && cycleDay <= 13;
        }

        function changeMonth(direction) {
            currentMonth += direction;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        }

        // Load history
        function loadHistory() {
            // Reload periodHistory from localStorage
            periodHistory = JSON.parse(localStorage.getItem('nutritrack_period_history') || '[]');
            
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            
            if (!periodHistory || periodHistory.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: #ff1493; padding: 40px; font-size: 1.1rem;">üå∏ Hen√ºz kayƒ±t yok. G√ºnl√ºk takip yaparak ba≈ülayƒ±n! üíï</p>';
                return;
            }
            
            // Sort by date (newest first)
            const sortedHistory = [...periodHistory].sort((a, b) => {
                return new Date(b.startDate) - new Date(a.startDate);
            });
            
            sortedHistory.forEach((period, index) => {
                const item = document.createElement('div');
                item.className = 'history-item';
                
                const startDate = new Date(period.startDate);
                let cycleLength = period.cycleLength;
                
                // Calculate cycle length if not set
                if (!cycleLength && index < sortedHistory.length - 1) {
                    const nextPeriod = new Date(sortedHistory[index + 1].startDate);
                    cycleLength = Math.ceil((startDate - nextPeriod) / (1000 * 60 * 60 * 24));
                }
                
                const flowLabels = {
                    'none': 'Yok',
                    'light': 'Hafif',
                    'medium': 'Orta',
                    'heavy': 'Yoƒüun'
                };
                
                const flowLabel = flowLabels[period.flow] || 'Belirtilmemi≈ü';
                const symptomsCount = period.symptoms ? period.symptoms.length : 0;
                const painLevel = period.pain !== null && period.pain !== undefined ? period.pain : '--';
                
                item.innerHTML = `
                    <div>
                        <div class="history-date">${startDate.toLocaleDateString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric' })}</div>
                        <div class="history-info">
                            ${cycleLength ? `D√∂ng√º: ${cycleLength} g√ºn ‚Ä¢ ` : ''}
                            Akƒ±≈ü: ${flowLabel}${painLevel !== '--' ? ` ‚Ä¢ Aƒürƒ±: ${painLevel}/10` : ''}
                        </div>
                    </div>
                    <div style="color: #ff69b4; font-weight: 600; font-size: 1.1rem;">
                        ${symptomsCount > 0 ? `üíñ ${symptomsCount} semptom` : '‚ú® Semptom yok'}
                    </div>
                `;
                
                historyList.appendChild(item);
            });
        }

        // Update nutrition tips based on cycle phase
        function updateNutritionTips() {
            if (!userData.lastPeriod) {
                document.getElementById('nutritionTips').innerHTML = '<p>Adet takibi ba≈ülatmak i√ßin profil sayfasƒ±ndan son adet tarihinizi girin.</p>';
                return;
            }
            
            const lastPeriod = new Date(userData.lastPeriod);
            const cycleLength = userData.cycleLength || 28;
            const today = new Date();
            const daysSincePeriod = Math.ceil((today - lastPeriod) / (1000 * 60 * 60 * 24));
            const cycleDay = (daysSincePeriod % cycleLength) || cycleLength;
            
            let phase = '';
            let tips = [];
            
            if (cycleDay <= 5) {
                phase = 'Adet D√∂nemi';
                tips = [
                    { icon: 'ü•©', title: 'Demir Alƒ±mƒ±', text: 'Kƒ±rmƒ±zƒ± et, ƒ±spanak ve baklagiller t√ºketin' },
                    { icon: 'ü•õ', title: 'Kalsiyum', text: 'S√ºt √ºr√ºnleri ve ye≈üil yapraklƒ± sebzeler' },
                    { icon: 'üçä', title: 'C Vitamini', text: 'Turun√ßgiller demir emilimini artƒ±rƒ±r' },
                    { icon: 'üíß', title: 'Su T√ºketimi', text: 'G√ºnde en az 2-2.5 litre su i√ßin' }
                ];
            } else if (cycleDay <= 13) {
                phase = 'Folik√ºler Faz';
                tips = [
                    { icon: 'ü•ó', title: 'Antioksidanlar', text: 'Renkli sebzeler ve meyveler' },
                    { icon: 'üåæ', title: 'Tam Tahƒ±llar', text: 'Enerji i√ßin kompleks karbonhidratlar' },
                    { icon: 'ü•ë', title: 'Saƒülƒ±klƒ± Yaƒülar', text: 'Avokado, zeytinyaƒüƒ± ve kuruyemi≈üler' },
                    { icon: 'üêü', title: 'Omega-3', text: 'Balƒ±k ve keten tohumu' }
                ];
            } else if (cycleDay === 14) {
                phase = 'Yumurtlama D√∂nemi';
                tips = [
                    { icon: 'üêü', title: 'Omega-3', text: 'Balƒ±k, ceviz ve keten tohumu' },
                    { icon: 'ü•¶', title: 'Antioksidanlar', text: 'Renkli sebzeler ve meyveler' },
                    { icon: 'üå∞', title: '√áinko', text: 'Kabak √ßekirdeƒüi ve kaju' },
                    { icon: 'ü•õ', title: 'Kalsiyum', text: 'S√ºt √ºr√ºnleri ve badem' }
                ];
            } else {
                phase = 'Luteal Faz';
                tips = [
                    { icon: 'üçå', title: 'Magnezyum', text: 'Muz, badem ve ye≈üil yapraklƒ± sebzeler' },
                    { icon: 'üç´', title: 'Kakao', text: 'Bitter √ßikolata (√∂l√ß√ºl√º)' },
                    { icon: 'üåæ', title: 'B Vitamini', text: 'Tam tahƒ±llar ve baklagiller' },
                    { icon: 'ü•õ', title: 'Kalsiyum', text: 'S√ºt √ºr√ºnleri ve susam' }
                ];
            }
            
            let html = `<div style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, rgba(255, 105, 180, 0.2), rgba(255, 20, 147, 0.15)); border-radius: 15px; text-align: center;">
                <div style="font-size: 1.2rem; font-weight: 700; color: #ff1493; margin-bottom: 5px;">${phase}</div>
                <div style="font-size: 0.9rem; color: #666;">D√∂ng√º G√ºn√º: ${cycleDay}</div>
            </div>`;
            
            tips.forEach(tip => {
                html += `
                    <div class="nutrition-tip">
                        <div class="tip-title">${tip.icon} ${tip.title}</div>
                        <div class="tip-text">${tip.text}</div>
                    </div>
                `;
            });
            
            document.getElementById('nutritionTips').innerHTML = html;
        }

        // Notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Theme toggle
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('nutritrack_theme', newTheme);
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const theme = document.documentElement.getAttribute('data-theme');
            const icon = document.getElementById('themeIcon');
            if (icon) {
                icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            }
        }
    </script>
</body>
</html>


