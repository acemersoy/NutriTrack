<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İlerleme & Raporlar - NutriTrack</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="smooth-scroll.js" defer></script>
    <script src="swipe.js" defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding-bottom: 80px;
            transition: background 0.3s ease, color 0.3s ease;
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ffffff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        /* STAT CARD - Material Design & WCAG */
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        [data-theme="dark"] .stat-card {
            background: rgba(255, 255, 255, 0.08); /* Material Design: Elevated Surface */
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] .stat-card:hover {
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 15px;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* CHART SECTION - Material Design & WCAG */
        .chart-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .chart-section {
            background: rgba(30, 30, 40, 0.95); /* Material Design: Surface */
            border: 1px solid rgba(80, 80, 100, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 25px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: color 0.3s ease;
        }

        [data-theme="dark"] .section-title {
            color: rgba(255, 255, 255, 0.87); /* WCAG: High emphasis */
        }

        [data-theme="dark"] .section-title i {
            color: #A0B4FF;
        }

        .chart-container {
            position: relative;
            height: 300px;
            min-height: 300px;
            margin-bottom: 20px;
            width: 100%;
            display: block !important;
        }

        .chart-container canvas {
            display: block !important;
            width: 100% !important;
            height: 100% !important;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        /* PROGRESS SECTION - Material Design & WCAG */
        .progress-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .progress-section {
            background: rgba(30, 30, 40, 0.95); /* Material Design: Surface */
            border: 1px solid rgba(80, 80, 100, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .progress-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
        }

        .progress-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .progress-card {
            background: rgba(40, 40, 55, 0.9); /* Material Design: Component */
            border: 1px solid rgba(80, 80, 100, 0.3);
        }

        .progress-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        [data-theme="dark"] .progress-card:hover {
            background: rgba(50, 50, 65, 0.9);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }

        .progress-circle {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            position: relative;
        }

        .progress-circle svg {
            transform: rotate(-90deg);
        }

        .progress-circle-bg {
            fill: none;
            stroke: #e6e6e6;
            stroke-width: 8;
        }

        [data-theme="dark"] .progress-circle-bg {
            stroke: rgba(80, 80, 100, 0.4);
        }

        .progress-circle-progress {
            fill: none;
            stroke: #667eea;
            stroke-width: 8;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
        }

        [data-theme="dark"] .progress-circle-progress {
            stroke: #A0B4FF;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
            transition: color 0.3s ease;
        }

        [data-theme="dark"] .progress-text {
            color: #A0B4FF;
        }

        .progress-label {
            font-weight: 500;
            color: #1a1a1a;
            margin-bottom: 10px;
            transition: color 0.3s ease;
        }

        [data-theme="dark"] .progress-label {
            color: rgba(255, 255, 255, 0.87); /* WCAG: High emphasis */
        }

        .progress-description {
            color: #4a4a4a;
            font-size: 0.9rem;
            line-height: 1.4;
            transition: color 0.3s ease;
        }

        [data-theme="dark"] .progress-description {
            color: rgba(255, 255, 255, 0.60); /* Material Design: Medium emphasis */
        }

        /* ACHIEVEMENTS SECTION - Material Design & WCAG */
        .achievements-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .achievements-section {
            background: rgba(30, 30, 40, 0.95); /* Material Design: Surface */
            border: 1px solid rgba(80, 80, 100, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .achievement-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        [data-theme="dark"] .achievement-card {
            background: rgba(40, 40, 55, 0.9); /* Material Design: Component */
            border: 1px solid rgba(80, 80, 100, 0.3);
        }

        .achievement-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .achievement-card:hover {
            background: rgba(50, 50, 65, 0.9);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .achievement-card.unlocked {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: scale(1.05);
            border-color: transparent;
        }

        [data-theme="dark"] .achievement-card.unlocked {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.95), rgba(118, 75, 162, 0.95));
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .achievement-icon {
            font-size: 2rem;
            margin-bottom: 15px;
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }

        [data-theme="dark"] .achievement-icon {
            opacity: 0.4;
        }

        .achievement-card.unlocked .achievement-icon {
            opacity: 1;
        }

        .achievement-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #1a1a1a;
            transition: color 0.3s ease;
        }

        [data-theme="dark"] .achievement-title {
            color: rgba(255, 255, 255, 0.87);
        }

        [data-theme="dark"] .achievement-card.unlocked .achievement-title {
            color: white;
        }

        .achievement-description {
            font-size: 0.8rem;
            opacity: 0.7;
            color: #4a4a4a;
            transition: color 0.3s ease;
        }

        [data-theme="dark"] .achievement-description {
            color: rgba(255, 255, 255, 0.60);
            opacity: 1;
        }

        [data-theme="dark"] .achievement-card.unlocked .achievement-description {
            color: rgba(255, 255, 255, 0.87);
        }

        /* WEEKLY SUMMARY - Material Design & WCAG */
        .weekly-summary {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .weekly-summary {
            background: rgba(30, 30, 40, 0.95); /* Material Design: Surface */
            border: 1px solid rgba(80, 80, 100, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-item {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .summary-item {
            background: rgba(40, 40, 55, 0.9); /* Material Design: Component */
            border: 1px solid rgba(80, 80, 100, 0.3);
        }

        .summary-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .summary-item:hover {
            background: rgba(50, 50, 65, 0.9);
        }

        .summary-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
            transition: color 0.3s ease;
        }

        [data-theme="dark"] .summary-value {
            color: #A0B4FF;
        }

        .summary-label {
            color: #4a4a4a;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }

        [data-theme="dark"] .summary-label {
            color: rgba(255, 255, 255, 0.60); /* Material Design: Medium emphasis */
        }

        /* NAVIGATION - Material Design & WCAG */
        .navigation {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            padding: 15px 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            gap: 20px;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .navigation {
            background: rgba(40, 40, 55, 0.95); /* Material Design: Elevated Surface */
            border: 1px solid rgba(80, 80, 100, 0.5);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
        }

        .nav-item {
            color: #667eea;
            font-size: 1.5rem;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
        }

        [data-theme="dark"] .nav-item {
            color: #A0B4FF;
        }

        .nav-item:hover, .nav-item.active {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }

        [data-theme="dark"] .nav-item:hover,
        [data-theme="dark"] .nav-item.active {
            background: rgba(102, 126, 234, 0.9);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        /* RESPONSIVE DESIGN - Mobile First */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 250px;
            }
            
            .chart-section,
            .progress-section,
            .achievements-section,
            .weekly-summary {
                padding: 20px;
            }

            .section-title {
                font-size: 1.3rem;
            }
            
            .progress-grid {
                grid-template-columns: 1fr;
            }
            
            .achievements-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .stats-overview {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .stat-card {
                padding: 20px;
            }

            .navigation {
                bottom: 10px;
                padding: 10px 20px;
                gap: 15px;
            }

            .nav-item {
                font-size: 1.2rem;
                padding: 8px;
            }
        }

        @media (max-width: 480px) {
            .stats-overview {
                grid-template-columns: 1fr;
            }

            .achievements-grid {
                grid-template-columns: 1fr;
            }

            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .stat-value,
            .summary-value {
                font-size: 1.5rem;
            }

            .chart-container {
                height: 200px;
            }
        }

        /* Koyu mod için progress.html özel stilleri */
        [data-theme="dark"] .chart-section,
        [data-theme="dark"] .progress-section,
        [data-theme="dark"] .achievements-section,
        [data-theme="dark"] .weekly-summary {
            background: rgba(30, 30, 40, 0.95);
            border: 1px solid var(--border-color);
        }

        [data-theme="dark"] .progress-card,
        [data-theme="dark"] .summary-item {
            background: rgba(25, 25, 35, 0.8);
        }

        [data-theme="dark"] .achievement-card {
            background: rgba(25, 25, 35, 0.8);
        }

        [data-theme="dark"] .progress-label {
            color: #ffffff;
        }

        [data-theme="dark"] .progress-description {
            color: #d0d0d0;
        }

        [data-theme="dark"] .achievement-title {
            color: #1a1a1a;
        }

        [data-theme="dark"] .achievement-card.unlocked .achievement-title {
            color: #ffffff;
        }

        [data-theme="dark"] .achievement-description {
            color: #4a4a4a;
        }

        [data-theme="dark"] .achievement-card.unlocked .achievement-description {
            color: rgba(255, 255, 255, 0.9);
        }

        [data-theme="dark"] .summary-label {
            color: #d0d0d0;
        }

        /* Açık mod için daha iyi kontrast */
        .achievement-title {
            color: #1a1a1a;
        }

        .achievement-description {
            color: #4a4a4a;
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()" title="Tema Değiştir">
        <i class="fas fa-moon" id="themeIcon"></i>
    </button>

    <div class="container">
        <div class="header">
            <h1><i class="fas fa-chart-line"></i> İlerleme & Raporlar</h1>
            <p>Sağlık yolculuğunuzda ilerlemenizi takip edin</p>
        </div>

        <div class="stats-overview">
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-fire"></i></div>
                <div class="stat-value" id="totalCalories">0</div>
                <div class="stat-label">Toplam Kalori (Bugün)</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-tint"></i></div>
                <div class="stat-value" id="totalWater">0</div>
                <div class="stat-label">Toplam Su (bardak)</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
                <div class="stat-value" id="streakDays">0</div>
                <div class="stat-label">Takip Günü</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-trophy"></i></div>
                <div class="stat-value" id="achievementCount">0</div>
                <div class="stat-label">Başarım</div>
            </div>
        </div>

        <div class="chart-grid">
            <div class="chart-section">
                <h3 class="section-title">
                    <i class="fas fa-chart-line"></i>
                    Günlük Kalori Takibi
                </h3>
                <div class="chart-container">
                    <canvas id="calorieChart"></canvas>
                </div>
            </div>

            <div class="chart-section">
                <h3 class="section-title">
                    <i class="fas fa-chart-pie"></i>
                    Makro Besin Dağılımı
                </h3>
                <div class="chart-container">
                    <canvas id="macroChart"></canvas>
                </div>
            </div>
        </div>

        <div class="progress-section">
            <h3 class="section-title">
                <i class="fas fa-bullseye"></i>
                Hedef İlerlemesi
            </h3>
            <div class="progress-grid">
                <div class="progress-card">
                    <div class="progress-circle">
                        <svg width="120" height="120">
                            <circle class="progress-circle-bg" cx="60" cy="60" r="52"></circle>
                            <circle class="progress-circle-progress" id="calorieProgressCircle" cx="60" cy="60" r="52"></circle>
                        </svg>
                        <div class="progress-text" id="calorieProgressText">0%</div>
                    </div>
                    <div class="progress-label">Kalori Hedefi</div>
                    <div class="progress-description">Günlük kalori hedefinize ulaşma durumu</div>
                </div>

                <div class="progress-card">
                    <div class="progress-circle">
                        <svg width="120" height="120">
                            <circle class="progress-circle-bg" cx="60" cy="60" r="52"></circle>
                            <circle class="progress-circle-progress" id="waterProgressCircle" cx="60" cy="60" r="52"></circle>
                        </svg>
                        <div class="progress-text" id="waterProgressText">0%</div>
                    </div>
                    <div class="progress-label">Su Hedefi</div>
                    <div class="progress-description">Günlük su tüketimi hedefiniz</div>
                </div>

                <div class="progress-card">
                    <div class="progress-circle">
                        <svg width="120" height="120">
                            <circle class="progress-circle-bg" cx="60" cy="60" r="52"></circle>
                            <circle class="progress-circle-progress" id="proteinProgressCircle" cx="60" cy="60" r="52"></circle>
                        </svg>
                        <div class="progress-text" id="proteinProgressText">0%</div>
                    </div>
                    <div class="progress-label">Protein Hedefi</div>
                    <div class="progress-description">Günlük protein ihtiyacınız</div>
                </div>
            </div>
        </div>

        <div class="achievements-section">
            <h3 class="section-title">
                <i class="fas fa-trophy"></i>
                Başarılar
            </h3>
            <div class="achievements-grid" id="achievementsGrid">
                <!-- Başarılar dinamik olarak eklenecek -->
            </div>
        </div>

        <div class="weekly-summary">
            <h3 class="section-title">
                <i class="fas fa-calendar-week"></i>
                Haftalık Özet
            </h3>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-value" id="weeklyCalories">0</div>
                    <div class="summary-label">Ort. Kalori/Gün</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="weeklyWater">0</div>
                    <div class="summary-label">Toplam Su</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="weeklyProtein">0g</div>
                    <div class="summary-label">Ort. Protein/Gün</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="bestStreak">0</div>
                    <div class="summary-label">En Uzun Seri</div>
                </div>
            </div>
        </div>
    </div>

    <nav class="navigation">
        <a href="index.html" class="nav-item" title="Ana Sayfa"><i class="fas fa-home"></i></a>
        <a href="nutrition.html" class="nav-item" title="Besin Takibi"><i class="fas fa-utensils"></i></a>
        <a href="recipes.html" class="nav-item" title="Tariflerim"><i class="fas fa-book"></i></a>
        <a href="profile.html" class="nav-item" title="Profil"><i class="fas fa-user"></i></a>
        <a href="progress.html" class="nav-item active" title="İlerleme"><i class="fas fa-chart-bar"></i></a>
    </nav>

    <script>
        let calorieChart, macroChart;
        let todayData = {};
        let userData = {};

        // Tema yönetimi
        function initTheme() {
            const savedTheme = localStorage.getItem('nutritrack_theme') || 'light';
            setTheme(savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            setTheme(newTheme);
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('nutritrack_theme', theme);
            
            const themeIcon = document.getElementById('themeIcon');
            if (themeIcon) {
                themeIcon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            }
            
            // Chart'ların renklerini güncelle (yeniden oluşturmadan)
            updateChartColors(theme === 'dark');
        }

        // Chart renklerini güncelle (chart'ı yeniden oluşturmadan)
        function updateChartColors(isDarkMode) {
            if (!calorieChart || !macroChart) return;
            
            // Renk paleti
            const chartColors = isDarkMode ? {
                primary: 'rgba(138, 158, 255, 0.9)',
                primaryBg: 'rgba(138, 158, 255, 0.15)',
                secondary: 'rgba(156, 136, 255, 0.9)',
                text: '#FFFFFF',
                grid: 'rgba(255, 255, 255, 0.12)'
            } : {
                primary: '#667eea',
                primaryBg: 'rgba(102, 126, 234, 0.1)',
                secondary: '#764ba2',
                text: '#1a1a1a',
                grid: 'rgba(0, 0, 0, 0.12)'
            };
            
            const macroColors = isDarkMode ? {
                protein: 'rgba(138, 158, 255, 0.85)',
                carbs: 'rgba(156, 136, 255, 0.85)',
                fat: 'rgba(255, 138, 199, 0.85)',
                border: 'rgba(30, 30, 40, 0.8)'
            } : {
                protein: '#667eea',
                carbs: '#764ba2',
                fat: '#f093fb',
                border: '#ffffff'
            };
            
            // Kalori chart renklerini güncelle
            if (calorieChart) {
                calorieChart.data.datasets[0].borderColor = chartColors.primary;
                calorieChart.data.datasets[0].backgroundColor = chartColors.primaryBg;
                calorieChart.data.datasets[0].pointBackgroundColor = chartColors.primary;
                calorieChart.data.datasets[1].borderColor = chartColors.secondary;
                
                calorieChart.options.plugins.legend.labels.color = chartColors.text;
                calorieChart.options.plugins.tooltip.titleColor = isDarkMode ? '#FFFFFF' : '#1a1a1a';
                calorieChart.options.plugins.tooltip.bodyColor = isDarkMode ? '#FFFFFF' : '#1a1a1a';
                calorieChart.options.plugins.tooltip.backgroundColor = isDarkMode ? 'rgba(30, 30, 40, 0.98)' : 'rgba(255, 255, 255, 0.98)';
                calorieChart.options.plugins.tooltip.borderColor = isDarkMode ? 'rgba(80, 80, 100, 0.5)' : 'rgba(0, 0, 0, 0.2)';
                
                calorieChart.options.scales.y.ticks.color = chartColors.text;
                calorieChart.options.scales.y.grid.color = chartColors.grid;
                calorieChart.options.scales.x.ticks.color = chartColors.text;
                calorieChart.options.scales.x.grid.color = chartColors.grid;
                
                calorieChart.update('none'); // Animasyonsuz güncelle
            }
            
            // Makro chart renklerini güncelle
            if (macroChart) {
                macroChart.data.datasets[0].backgroundColor = [
                    macroColors.protein,
                    macroColors.carbs,
                    macroColors.fat
                ];
                macroChart.data.datasets[0].borderColor = macroColors.border;
                
                macroChart.options.plugins.legend.labels.color = chartColors.text;
                macroChart.options.plugins.tooltip.titleColor = isDarkMode ? '#FFFFFF' : '#1a1a1a';
                macroChart.options.plugins.tooltip.bodyColor = isDarkMode ? '#FFFFFF' : '#1a1a1a';
                macroChart.options.plugins.tooltip.backgroundColor = isDarkMode ? 'rgba(30, 30, 40, 0.98)' : 'rgba(255, 255, 255, 0.98)';
                macroChart.options.plugins.tooltip.borderColor = isDarkMode ? 'rgba(80, 80, 100, 0.5)' : 'rgba(0, 0, 0, 0.2)';
                
                macroChart.update('none'); // Animasyonsuz güncelle
            }
        }

        // Sayfa yüklendiğinde verileri yükle
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            loadData();
            
            // Chart.js yüklendikten sonra grafikleri başlat
            if (typeof Chart === 'undefined') {
                console.error('❌ Chart.js yüklenemedi! CDN kontrol edin.');
                // CDN'den yüklenmesini bekle
                setTimeout(() => {
                    if (typeof Chart !== 'undefined') {
                        initializeCharts();
                    } else {
                        console.error('❌ Chart.js hala yüklenemedi');
                    }
                }, 1000);
            } else {
                initializeCharts();
            }
            
            updateProgressCircles();
            updateAchievements();
            updateWeeklySummary();
        });

        // Verileri yükle
        function loadData() {
            todayData = JSON.parse(localStorage.getItem('nutritrack_today') || '{}');
            userData = JSON.parse(localStorage.getItem('nutritrack_user') || '{}');
            
            // İstatistikleri güncelle
            document.getElementById('totalCalories').textContent = todayData.calories || 0;
            document.getElementById('totalWater').textContent = todayData.water || 0;
            
            // Streak hesapla
            const startDate = userData.startDate ? new Date(userData.startDate) : new Date();
            const today = new Date();
            const diffTime = Math.abs(today - startDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            document.getElementById('streakDays').textContent = diffDays;
        }

        // Grafikleri başlat
        function initializeCharts() {
            try {
                // Chart.js yüklü mü kontrol et
                if (typeof Chart === 'undefined') {
                    console.error('❌ Chart.js yüklenmemiş!');
                    return;
                }
                
                // Canvas elementlerini kontrol et
                const calorieCanvas = document.getElementById('calorieChart');
                const macroCanvas = document.getElementById('macroChart');
                
                if (!calorieCanvas || !macroCanvas) {
                    console.error('❌ Canvas elementleri bulunamadı');
                    return;
                }
                
                // Kalori takip grafiği
                const calorieCtx = calorieCanvas.getContext('2d');
                
                // Gerçek veri - son 7 gün (localStorage'dan)
                const last7Days = [];
                const calorieData = [];
                const targetCalories = userData.targetCalories || 2000;
                
                // Geçmiş verileri al
                const historyData = JSON.parse(localStorage.getItem('nutritrack_history') || '{}');
                const todayDataForChart = JSON.parse(localStorage.getItem('nutritrack_today') || '{}');
                const today = new Date();
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0]; // YYYY-MM-DD
                    last7Days.push(date.toLocaleDateString('tr-TR', { weekday: 'short' }));
                    
                    // Bugünse todayData'dan al, değilse historyData'dan
                    if (i === 0) {
                        // Bugün
                        calorieData.push(todayDataForChart.calories || 0);
                    } else {
                        // Geçmiş günler
                        const dayData = historyData[dateStr];
                        calorieData.push(dayData ? (dayData.calories || 0) : 0);
                    }
                }

            // Dark mode kontrolü
            const isDarkMode = document.documentElement.getAttribute('data-theme') === 'dark';
            
            // Dark mode'a göre renkler (Material Design + WCAG)
            const chartColors = isDarkMode ? {
                primary: 'rgba(138, 158, 255, 0.9)',      // A0B4FF
                primaryBg: 'rgba(138, 158, 255, 0.15)',
                secondary: 'rgba(156, 136, 255, 0.9)',    // 9C88FF
                text: '#FFFFFF',                          // Karanlık modda beyaz
                textSecondary: 'rgba(255, 255, 255, 0.87)',
                grid: 'rgba(255, 255, 255, 0.12)'
            } : {
                primary: '#667eea',
                primaryBg: 'rgba(102, 126, 234, 0.1)',
                secondary: '#764ba2',
                text: '#1a1a1a',                          // Açık modda koyu siyah
                textSecondary: '#333333',
                grid: 'rgba(0, 0, 0, 0.12)'
            };

            calorieChart = new Chart(calorieCtx, {
                type: 'line',
                data: {
                    labels: last7Days,
                    datasets: [{
                        label: 'Günlük Kalori',
                        data: calorieData,
                        borderColor: chartColors.primary,
                        backgroundColor: chartColors.primaryBg,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: chartColors.primary,
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }, {
                        label: 'Hedef Kalori',
                        data: Array(7).fill(targetCalories),
                        borderColor: chartColors.secondary,
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: chartColors.text,
                                font: {
                                    family: "'Inter', sans-serif",
                                    size: 12,
                                    weight: '500'
                                },
                                padding: 15,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            backgroundColor: isDarkMode 
                                ? 'rgba(30, 30, 40, 0.98)' 
                                : 'rgba(255, 255, 255, 0.98)',
                            titleColor: isDarkMode ? '#FFFFFF' : '#1a1a1a',  // Açık: Siyah / Koyu: Beyaz
                            bodyColor: isDarkMode ? '#FFFFFF' : '#1a1a1a',   // Açık: Siyah / Koyu: Beyaz
                            borderColor: isDarkMode 
                                ? 'rgba(80, 80, 100, 0.5)' 
                                : 'rgba(0, 0, 0, 0.2)',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: true,
                            boxPadding: 5
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                color: chartColors.text,  // Siyah (açık) / Beyaz (koyu)
                                font: {
                                    family: "'Inter', sans-serif",
                                    size: 11,
                                    weight: '500'
                                },
                                callback: function(value) {
                                    return value + ' kcal';
                                }
                            },
                            grid: {
                                color: chartColors.grid,
                                drawBorder: false
                            }
                        },
                        x: {
                            ticks: {
                                color: chartColors.text,  // Siyah (açık) / Beyaz (koyu)
                                font: {
                                    family: "'Inter', sans-serif",
                                    size: 11,
                                    weight: '500'
                                }
                            },
                            grid: {
                                color: chartColors.grid,
                                drawBorder: false
                            }
                        }
                    }
                }
            });

            // Makro besin dağılımı grafiği
            const macroCtx = document.getElementById('macroChart').getContext('2d');
            
            // Bugünkü makro besin değerleri (örnek)
            const todayMacros = calculateTodayMacros();
            
            // Makro chart için renkler
            const macroColors = isDarkMode ? {
                protein: 'rgba(138, 158, 255, 0.85)',   // A0B4FF
                carbs: 'rgba(156, 136, 255, 0.85)',      // 9C88FF
                fat: 'rgba(255, 138, 199, 0.85)',        // FF8AC7
                border: 'rgba(30, 30, 40, 0.8)'
            } : {
                protein: '#667eea',
                carbs: '#764ba2',
                fat: '#f093fb',
                border: '#ffffff'
            };

            macroChart = new Chart(macroCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Protein', 'Karbonhidrat', 'Yağ'],
                    datasets: [{
                        data: [todayMacros.protein, todayMacros.carbs, todayMacros.fat],
                        backgroundColor: [
                            macroColors.protein,
                            macroColors.carbs,
                            macroColors.fat
                        ],
                        borderWidth: 2,
                        borderColor: macroColors.border,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                color: chartColors.text,  // Siyah (açık) / Beyaz (koyu)
                                font: {
                                    family: "'Inter', sans-serif",
                                    size: 12,
                                    weight: '600'
                                },
                                padding: 15,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: isDarkMode 
                                ? 'rgba(30, 30, 40, 0.98)' 
                                : 'rgba(255, 255, 255, 0.98)',
                            titleColor: isDarkMode ? '#FFFFFF' : '#1a1a1a',  // Açık: Siyah / Koyu: Beyaz
                            bodyColor: isDarkMode ? '#FFFFFF' : '#1a1a1a',   // Açık: Siyah / Koyu: Beyaz
                            borderColor: isDarkMode 
                                ? 'rgba(80, 80, 100, 0.5)' 
                                : 'rgba(0, 0, 0, 0.2)',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: true,
                            boxPadding: 5
                        }
                    },
                    animation: {
                        animateRotate: true,
                        animateScale: true,
                        duration: 800,
                        easing: 'easeInOutQuart'
                    }
                }
            });
            
            } catch (error) {
                console.error('❌ Chart oluşturma hatası:', error);
            }
        }

        // Bugünkü makro besinleri hesapla
        function calculateTodayMacros() {
            if (!todayData.foods || todayData.foods.length === 0) {
                return { protein: 0, carbs: 0, fat: 0 };
            }

            let totalProtein = 0, totalCarbs = 0, totalFat = 0;
            
            todayData.foods.forEach(food => {
                if (food.nutrients) {
                    totalProtein += food.nutrients.protein || 0;
                    totalCarbs += food.nutrients.carbs || 0;
                    totalFat += food.nutrients.fat || 0;
                }
            });

            return {
                protein: Math.round(totalProtein),
                carbs: Math.round(totalCarbs),
                fat: Math.round(totalFat)
            };
        }

        // İlerleme dairelerini güncelle
        function updateProgressCircles() {
            const targetCalories = userData.targetCalories || 2000;
            const consumedCalories = todayData.calories || 0;
            const caloriePercentage = Math.min((consumedCalories / targetCalories) * 100, 100);
            
            updateCircle('calorieProgressCircle', 'calorieProgressText', caloriePercentage);
            
            const targetWater = 8; // Bardak
            const consumedWater = todayData.water || 0;
            const waterPercentage = Math.min((consumedWater / targetWater) * 100, 100);
            
            updateCircle('waterProgressCircle', 'waterProgressText', waterPercentage);
            
            // Protein hedefi (kilo başına 1.6g)
            const targetProtein = userData.weight ? Math.round(userData.weight * 1.6) : 60;
            const todayMacros = calculateTodayMacros();
            const proteinPercentage = Math.min((todayMacros.protein / targetProtein) * 100, 100);
            
            updateCircle('proteinProgressCircle', 'proteinProgressText', proteinPercentage);
        }

        // İlerleme dairesini güncelle
        function updateCircle(circleId, textId, percentage) {
            const circle = document.getElementById(circleId);
            const text = document.getElementById(textId);
            
            const circumference = 2 * Math.PI * 52;
            const offset = circumference - (percentage / 100) * circumference;
            
            circle.style.strokeDasharray = circumference;
            circle.style.strokeDashoffset = offset;
            text.textContent = Math.round(percentage) + '%';
        }

        // Başarıları güncelle
        function updateAchievements() {
            const achievements = [
                {
                    id: 'first_day',
                    title: 'İlk Adım',
                    description: 'İlk gününü tamamladın',
                    icon: 'fas fa-play',
                    unlocked: true
                },
                {
                    id: 'week_streak',
                    title: 'Haftalık Seri',
                    description: '7 gün üst üste takip',
                    icon: 'fas fa-calendar-check',
                    unlocked: (userData.startDate && getDaysSinceStart() >= 7)
                },
                {
                    id: 'calorie_goal',
                    title: 'Kalori Hedefi',
                    description: 'Hedef kaloriye ulaştın',
                    icon: 'fas fa-bullseye',
                    unlocked: (todayData.calories >= (userData.targetCalories || 2000) * 0.9)
                },
                {
                    id: 'water_goal',
                    title: 'Su Hedefi',
                    description: 'Günlük su hedefini tamamladın',
                    icon: 'fas fa-tint',
                    unlocked: (todayData.water >= 8)
                },
                {
                    id: 'protein_goal',
                    title: 'Protein Hedefi',
                    description: 'Protein ihtiyacını karşıladın',
                    icon: 'fas fa-dumbbell',
                    unlocked: (calculateTodayMacros().protein >= (userData.weight || 60) * 1.6)
                },
                {
                    id: 'month_streak',
                    title: 'Aylık Seri',
                    description: '30 gün üst üste takip',
                    icon: 'fas fa-crown',
                    unlocked: (userData.startDate && getDaysSinceStart() >= 30)
                }
            ];

            const achievementsGrid = document.getElementById('achievementsGrid');
            let unlockedCount = 0;
            
            achievementsGrid.innerHTML = achievements.map(achievement => {
                if (achievement.unlocked) unlockedCount++;
                
                return `
                    <div class="achievement-card ${achievement.unlocked ? 'unlocked' : ''}">
                        <div class="achievement-icon">
                            <i class="${achievement.icon}"></i>
                        </div>
                        <div class="achievement-title">${achievement.title}</div>
                        <div class="achievement-description">${achievement.description}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('achievementCount').textContent = unlockedCount;
        }

        // Başlangıçtan bu yana kaç gün geçti
        function getDaysSinceStart() {
            if (!userData.startDate) return 0;
            const startDate = new Date(userData.startDate);
            const today = new Date();
            const diffTime = Math.abs(today - startDate);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        // Haftalık özet güncelle
        function updateWeeklySummary() {
            // Örnek veriler - gerçek uygulamada localStorage'dan alınır
            const weeklyCalories = Math.round((todayData.calories || 0) * 0.9);
            const weeklyWater = (todayData.water || 0) * 7;
            const weeklyProtein = Math.round(calculateTodayMacros().protein * 0.8);
            const bestStreak = Math.max(getDaysSinceStart(), 7);
            
            document.getElementById('weeklyCalories').textContent = weeklyCalories;
            document.getElementById('weeklyWater').textContent = weeklyWater;
            document.getElementById('weeklyProtein').textContent = weeklyProtein + 'g';
            document.getElementById('bestStreak').textContent = bestStreak;
        }

        // Sayfa görünür olduğunda güncelle
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                loadData();
                updateProgressCircles();
                updateAchievements();
                updateWeeklySummary();
            }
        });
    </script>
</body>
</html>