<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tariflerim - NutriTrack</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="db.js" defer></script>
    <script src="main.js" defer></script>
    <script src="smooth-scroll.js" defer></script>
    <script src="swipe.js" defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding-bottom: 80px;
            transition: background 0.3s ease, color 0.3s ease;
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: rgba(255, 255, 255, 0.87);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        /* CREATE RECIPE SECTION */
        .create-recipe-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .create-recipe-section {
            background: rgba(30, 30, 40, 0.95);
            border: 1px solid rgba(80, 80, 100, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 25px;
            color: #1a1a1a;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        [data-theme="dark"] .section-title {
            color: rgba(255, 255, 255, 0.87);
        }

        [data-theme="dark"] .section-title i {
            color: #A0B4FF;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #1a1a1a;
        }

        [data-theme="dark"] .form-label {
            color: rgba(255, 255, 255, 0.87);
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e6e6e6;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
            color: #1a1a1a;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        [data-theme="dark"] .form-input,
        [data-theme="dark"] .form-textarea {
            background: rgba(40, 40, 55, 0.9);
            border-color: rgba(80, 80, 100, 0.5);
            color: rgba(255, 255, 255, 0.87);
        }

        [data-theme="dark"] .form-input:focus,
        [data-theme="dark"] .form-textarea:focus {
            background: rgba(50, 50, 65, 0.95);
            border-color: rgba(102, 126, 234, 0.7);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        /* INGREDIENTS SECTION */
        .ingredients-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        [data-theme="dark"] .ingredients-section {
            background: rgba(25, 25, 35, 0.8);
            border: 1px solid rgba(80, 80, 100, 0.3);
        }

        .ingredient-search {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .ingredient-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .ingredient-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .ingredient-item {
            background: rgba(40, 40, 55, 0.9);
            border: 1px solid rgba(80, 80, 100, 0.3);
        }

        .ingredient-item:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .ingredient-info {
            flex: 1;
        }

        .ingredient-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: #1a1a1a;
        }

        [data-theme="dark"] .ingredient-name {
            color: rgba(255, 255, 255, 0.87);
        }

        .ingredient-amount {
            font-size: 0.9rem;
            color: #666;
        }

        [data-theme="dark"] .ingredient-amount {
            color: rgba(255, 255, 255, 0.60);
        }

        .ingredient-calories {
            font-weight: 600;
            color: #667eea;
            margin-right: 10px;
        }

        [data-theme="dark"] .ingredient-calories {
            color: #A0B4FF;
        }

        .remove-ingredient-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        /* NUTRITION SUMMARY */
        .nutrition-summary {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        [data-theme="dark"] .nutrition-summary {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .summary-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
        }

        [data-theme="dark"] .summary-item {
            background: rgba(40, 40, 55, 0.9);
            border: 1px solid rgba(80, 80, 100, 0.3);
        }

        .summary-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        [data-theme="dark"] .summary-value {
            color: #A0B4FF;
        }

        .summary-label {
            font-size: 0.85rem;
            color: #666;
        }

        [data-theme="dark"] .summary-label {
            color: rgba(255, 255, 255, 0.60);
        }

        /* BUTTONS */
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        /* MY RECIPES LIST */
        .recipes-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .recipe-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        [data-theme="dark"] .recipe-card {
            background: rgba(30, 30, 40, 0.95);
            border: 1px solid rgba(80, 80, 100, 0.3);
        }

        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .recipe-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .recipe-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 5px;
        }

        [data-theme="dark"] .recipe-name {
            color: rgba(255, 255, 255, 0.87);
        }

        .recipe-servings {
            font-size: 0.9rem;
            color: #666;
        }

        [data-theme="dark"] .recipe-servings {
            color: rgba(255, 255, 255, 0.60);
        }

        .recipe-actions {
            display: flex;
            gap: 5px;
        }

        .icon-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            color: #667eea;
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .icon-btn {
            color: #A0B4FF;
        }

        .icon-btn:hover {
            transform: scale(1.1);
        }

        .icon-btn.delete {
            color: #ff4757;
        }

        .recipe-nutrition {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .recipe-nutrient {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        [data-theme="dark"] .recipe-nutrient {
            background: rgba(25, 25, 35, 0.8);
        }

        .nutrient-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: #667eea;
        }

        [data-theme="dark"] .nutrient-value {
            color: #A0B4FF;
        }

        .nutrient-label {
            font-size: 0.75rem;
            color: #666;
            margin-top: 3px;
        }

        [data-theme="dark"] .nutrient-label {
            color: rgba(255, 255, 255, 0.60);
        }

        .recipe-ingredients-count {
            font-size: 0.9rem;
            color: #667eea;
            margin-bottom: 10px;
        }

        [data-theme="dark"] .recipe-ingredients-count {
            color: #A0B4FF;
        }

        .recipe-add-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .recipe-add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        [data-theme="dark"] .modal-content {
            background: rgba(30, 30, 40, 0.98);
            border: 1px solid rgba(80, 80, 100, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1a1a1a;
        }

        [data-theme="dark"] .modal-title {
            color: rgba(255, 255, 255, 0.87);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        [data-theme="dark"] .modal-close {
            color: rgba(255, 255, 255, 0.60);
        }

        /* NAVIGATION */
        .navigation {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            padding: 15px 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            gap: 20px;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .navigation {
            background: rgba(40, 40, 55, 0.95);
            border: 1px solid rgba(80, 80, 100, 0.5);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
        }

        .nav-item {
            color: #667eea;
            font-size: 1.5rem;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
        }

        [data-theme="dark"] .nav-item {
            color: #A0B4FF;
        }

        .nav-item:hover, .nav-item.active {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }

        [data-theme="dark"] .nav-item:hover,
        [data-theme="dark"] .nav-item.active {
            background: rgba(102, 126, 234, 0.9);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        [data-theme="dark"] .empty-state {
            color: rgba(255, 255, 255, 0.60);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .recipes-list {
                grid-template-columns: 1fr;
            }

            .recipe-nutrition {
                grid-template-columns: repeat(2, 1fr);
            }

            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .ingredient-search {
                flex-direction: column;
            }

            .navigation {
                bottom: 10px;
                padding: 10px 20px;
                gap: 15px;
            }

            .nav-item {
                font-size: 1.2rem;
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()" title="Tema Deƒüi≈ütir">
        <i class="fas fa-moon" id="themeIcon"></i>
    </button>

    <div class="container">
        <div class="header">
            <h1><i class="fas fa-book"></i> Tariflerim</h1>
            <p>Kendi yemeklerinizi olu≈üturun ve hƒ±zlƒ±ca ekleyin</p>
        </div>

        <!-- YENƒ∞ TARƒ∞F OLU≈ûTUR -->
        <div class="create-recipe-section">
            <h2 class="section-title"><i class="fas fa-plus-circle"></i> Yeni Tarif Olu≈ütur</h2>
            
            <div class="form-group">
                <label class="form-label">Tarif Adƒ±</label>
                <input type="text" class="form-input" id="recipeName" placeholder="√ñrn: Annemin Mercimek √áorbasƒ±">
            </div>

            <div class="form-group">
                <label class="form-label">A√ßƒ±klama (Opsiyonel)</label>
                <textarea class="form-textarea" id="recipeDescription" placeholder="Tarifin √∂zel notlarƒ± veya tarifi..."></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">Porsiyon Sayƒ±sƒ±</label>
                <input type="number" class="form-input" id="recipeServings" value="1" min="1" style="width: 150px;">
            </div>

            <!-- MALZEME EKLEME -->
            <div class="ingredients-section">
                <h3 class="form-label" style="margin-bottom: 15px;"><i class="fas fa-carrot"></i> Malzemeler</h3>
                
                <div class="ingredient-search">
                    <input type="text" class="form-input" id="ingredientSearch" placeholder="Malzeme ara (√∂rn: domates, pirin√ß)...">
                    <input type="number" class="form-input" id="ingredientAmount" placeholder="Miktar (g)" value="100" min="1" style="width: 150px;">
                    <button class="btn-primary" onclick="searchIngredient()">
                        <i class="fas fa-search"></i> Ara
                    </button>
                </div>

                <div id="ingredientResults" style="max-height: 200px; overflow-y: auto; margin-bottom: 15px;"></div>

                <div class="ingredient-list" id="recipeIngredients">
                    <div class="empty-state" style="padding: 30px;">
                        <i class="fas fa-utensils"></i>
                        <p>Hen√ºz malzeme eklemediniz</p>
                    </div>
                </div>

                <!-- BESƒ∞N DEƒûERƒ∞ √ñZETƒ∞ -->
                <div class="nutrition-summary" id="nutritionSummary" style="display: none;">
                    <h4 class="form-label" style="margin-bottom: 15px;">üìä Toplam Besin Deƒüerleri (Porsiyon Ba≈üƒ±na)</h4>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-value" id="totalCalories">0</div>
                            <div class="summary-label">Kalori</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value" id="totalProtein">0g</div>
                            <div class="summary-label">Protein</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value" id="totalCarbs">0g</div>
                            <div class="summary-label">Karbonhidrat</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value" id="totalFat">0g</div>
                            <div class="summary-label">Yaƒü</div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 15px; justify-content: flex-end;">
                <button class="btn-secondary" onclick="clearRecipeForm()">
                    <i class="fas fa-times"></i> Temizle
                </button>
                <button class="btn-primary" onclick="saveRecipe()">
                    <i class="fas fa-save"></i> Tarifi Kaydet
                </button>
            </div>
        </div>

        <!-- KAYDEDƒ∞LMƒ∞≈û TARƒ∞FLER -->
        <div class="create-recipe-section">
            <h2 class="section-title"><i class="fas fa-book-open"></i> Kayƒ±tlƒ± Tariflerim</h2>
            <div id="recipesList" class="recipes-list">
                <div class="empty-state">
                    <i class="fas fa-book"></i>
                    <p>Hen√ºz tarif kaydetmediniz</p>
                    <p style="font-size: 0.9rem; margin-top: 10px;">Yukarƒ±dan yeni tarif olu≈üturun!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- √ñƒû√úN SE√áƒ∞M MODALI -->
    <div class="modal" id="mealSelectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Hangi √ñƒü√ºne Eklemek ƒ∞stersiniz?</h3>
                <button class="modal-close" onclick="closeMealModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                <button class="btn-primary" onclick="addRecipeToMeal('breakfast')" style="padding: 20px;">
                    <span style="font-size: 2rem; display: block; margin-bottom: 10px;">üç≥</span>
                    Kahvaltƒ±
                </button>
                <button class="btn-primary" onclick="addRecipeToMeal('lunch')" style="padding: 20px;">
                    <span style="font-size: 2rem; display: block; margin-bottom: 10px;">üçΩÔ∏è</span>
                    √ñƒüle Yemeƒüi
                </button>
                <button class="btn-primary" onclick="addRecipeToMeal('dinner')" style="padding: 20px;">
                    <span style="font-size: 2rem; display: block; margin-bottom: 10px;">üåô</span>
                    Ak≈üam Yemeƒüi
                </button>
                <button class="btn-primary" onclick="addRecipeToMeal('snack')" style="padding: 20px;">
                    <span style="font-size: 2rem; display: block; margin-bottom: 10px;">üçé</span>
                    Ara √ñƒü√ºn
                </button>
            </div>
        </div>
    </div>

    <nav class="navigation">
        <a href="index.html" class="nav-item" title="Ana Sayfa"><i class="fas fa-home"></i></a>
        <a href="nutrition.html" class="nav-item" title="Besin Takibi"><i class="fas fa-utensils"></i></a>
        <a href="recipes.html" class="nav-item active" title="Tariflerim"><i class="fas fa-book"></i></a>
        <a href="profile.html" class="nav-item" title="Profil"><i class="fas fa-user"></i></a>
        <a href="progress.html" class="nav-item" title="ƒ∞lerleme"><i class="fas fa-chart-bar"></i></a>
    </nav>

    <script>
        let currentRecipeIngredients = [];
        let selectedRecipeForAdding = null;

        // Malzeme ara (USDA API)
        async function searchIngredient() {
            const query = document.getElementById('ingredientSearch').value.trim();
            const amount = parseFloat(document.getElementById('ingredientAmount').value) || 100;
            
            if (!query) {
                showNotification('L√ºtfen malzeme adƒ± girin', 'error');
                return;
            }

            const resultsDiv = document.getElementById('ingredientResults');
            resultsDiv.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;"><i class="fas fa-spinner fa-spin"></i> Aranƒ±yor...</div>';

            try {
                const foods = await app.searchFoods(query);
                
                if (foods.length === 0) {
                    resultsDiv.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">Sonu√ß bulunamadƒ±</div>';
                    return;
                }

                // ƒ∞lk 5 sonucu g√∂ster
                resultsDiv.innerHTML = foods.slice(0, 5).map(food => {
                    const nutrients = app.calculateNutrition(food, amount);
                    return `
                        <div class="ingredient-item" onclick='addIngredient(${JSON.stringify(food).replace(/'/g, "&#39;")}, ${amount})' style="cursor: pointer; margin-bottom: 10px;">
                            <div class="ingredient-info">
                                <div class="ingredient-name">${food.description || 'Bilinmeyen'}</div>
                                <div class="ingredient-amount">${amount}g</div>
                            </div>
                            <div class="ingredient-calories">${nutrients.calories || 0} kcal</div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Arama hatasƒ±:', error);
                resultsDiv.innerHTML = '<div style="text-align: center; padding: 20px; color: #ff4757;">Arama ba≈üarƒ±sƒ±z</div>';
            }
        }

        // Malzeme ekle
        function addIngredient(food, amount) {
            const nutrients = app.calculateNutrition(food, amount);
            
            const ingredient = {
                id: Date.now(),
                name: food.description || 'Bilinmeyen',
                amount: amount,
                nutrients: nutrients,
                rawFood: food // USDA verisini sakla
            };

            currentRecipeIngredients.push(ingredient);
            updateIngredientsList();
            updateNutritionSummary();
            
            // Arama kutusunu temizle
            document.getElementById('ingredientSearch').value = '';
            document.getElementById('ingredientResults').innerHTML = '';
            
            showNotification(`${ingredient.name} eklendi!`);
        }

        // Malzeme listesini g√ºncelle
        function updateIngredientsList() {
            const listDiv = document.getElementById('recipeIngredients');
            
            if (currentRecipeIngredients.length === 0) {
                listDiv.innerHTML = `
                    <div class="empty-state" style="padding: 30px;">
                        <i class="fas fa-utensils"></i>
                        <p>Hen√ºz malzeme eklemediniz</p>
                    </div>
                `;
                return;
            }

            listDiv.innerHTML = currentRecipeIngredients.map(ing => `
                <div class="ingredient-item">
                    <div class="ingredient-info">
                        <div class="ingredient-name">${ing.name}</div>
                        <div class="ingredient-amount">${ing.amount}g</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="ingredient-calories">${ing.nutrients.calories || 0} kcal</div>
                        <button class="remove-ingredient-btn" onclick="removeIngredient(${ing.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Malzeme kaldƒ±r
        function removeIngredient(ingredientId) {
            currentRecipeIngredients = currentRecipeIngredients.filter(ing => ing.id !== ingredientId);
            updateIngredientsList();
            updateNutritionSummary();
            showNotification('Malzeme kaldƒ±rƒ±ldƒ±');
        }

        // Besin deƒüerleri √∂zetini g√ºncelle
        function updateNutritionSummary() {
            const summaryDiv = document.getElementById('nutritionSummary');
            
            if (currentRecipeIngredients.length === 0) {
                summaryDiv.style.display = 'none';
                return;
            }

            summaryDiv.style.display = 'block';

            const servings = parseFloat(document.getElementById('recipeServings').value) || 1;
            
            let totalCalories = 0, totalProtein = 0, totalCarbs = 0, totalFat = 0;
            
            currentRecipeIngredients.forEach(ing => {
                totalCalories += ing.nutrients.calories || 0;
                totalProtein += ing.nutrients.protein || 0;
                totalCarbs += ing.nutrients.carbs || 0;
                totalFat += ing.nutrients.fat || 0;
            });

            // Porsiyon ba≈üƒ±na hesapla
            document.getElementById('totalCalories').textContent = Math.round(totalCalories / servings);
            document.getElementById('totalProtein').textContent = Math.round((totalProtein / servings) * 10) / 10 + 'g';
            document.getElementById('totalCarbs').textContent = Math.round((totalCarbs / servings) * 10) / 10 + 'g';
            document.getElementById('totalFat').textContent = Math.round((totalFat / servings) * 10) / 10 + 'g';
        }

        // Tarif kaydet
        function saveRecipe() {
            const recipeName = document.getElementById('recipeName').value.trim();
            const recipeDescription = document.getElementById('recipeDescription').value.trim();
            const servings = parseFloat(document.getElementById('recipeServings').value) || 1;

            if (!recipeName) {
                showNotification('L√ºtfen tarif adƒ± girin', 'error');
                return;
            }

            if (currentRecipeIngredients.length === 0) {
                showNotification('L√ºtfen en az bir malzeme ekleyin', 'error');
                return;
            }

            // Toplam besin deƒüerlerini hesapla
            let totalNutrients = {
                calories: 0,
                protein: 0,
                carbs: 0,
                fat: 0
            };

            // T√ºm mikro besinleri de topla
            let allMicronutrients = {};

            currentRecipeIngredients.forEach(ing => {
                totalNutrients.calories += ing.nutrients.calories || 0;
                totalNutrients.protein += ing.nutrients.protein || 0;
                totalNutrients.carbs += ing.nutrients.carbs || 0;
                totalNutrients.fat += ing.nutrients.fat || 0;

                // Mikro besinleri topla
                Object.keys(ing.nutrients).forEach(key => {
                    const nutrient = ing.nutrients[key];
                    if (typeof nutrient === 'object' && nutrient.value) {
                        if (!allMicronutrients[key]) {
                            allMicronutrients[key] = { value: 0, unit: nutrient.unit };
                        }
                        allMicronutrients[key].value += nutrient.value;
                    }
                });
            });

            // Porsiyon ba≈üƒ±na hesapla
            const perServing = {
                calories: Math.round(totalNutrients.calories / servings),
                protein: Math.round((totalNutrients.protein / servings) * 10) / 10,
                carbs: Math.round((totalNutrients.carbs / servings) * 10) / 10,
                fat: Math.round((totalNutrients.fat / servings) * 10) / 10
            };

            // Mikro besinleri de porsiyon ba≈üƒ±na hesapla
            Object.keys(allMicronutrients).forEach(key => {
                allMicronutrients[key].value = Math.round((allMicronutrients[key].value / servings) * 1000) / 1000;
            });

            const recipe = {
                id: Date.now(),
                name: recipeName,
                description: recipeDescription,
                servings: servings,
                ingredients: currentRecipeIngredients,
                nutrientsPerServing: perServing,
                micronutrientsPerServing: allMicronutrients,
                createdAt: new Date().toISOString()
            };

            // LocalStorage'a kaydet
            let recipes = JSON.parse(localStorage.getItem('nutritrack_recipes') || '[]');
            recipes.push(recipe);
            localStorage.setItem('nutritrack_recipes', JSON.stringify(recipes));

            showNotification(`‚úÖ "${recipeName}" tarifi kaydedildi!`);
            clearRecipeForm();
            loadRecipes();
        }

        // Formu temizle
        function clearRecipeForm() {
            document.getElementById('recipeName').value = '';
            document.getElementById('recipeDescription').value = '';
            document.getElementById('recipeServings').value = '1';
            document.getElementById('ingredientSearch').value = '';
            document.getElementById('ingredientAmount').value = '100';
            document.getElementById('ingredientResults').innerHTML = '';
            currentRecipeIngredients = [];
            updateIngredientsList();
            updateNutritionSummary();
        }

        // Tarifleri y√ºkle
        function loadRecipes() {
            const recipes = JSON.parse(localStorage.getItem('nutritrack_recipes') || '[]');
            const listDiv = document.getElementById('recipesList');

            if (recipes.length === 0) {
                listDiv.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-book"></i>
                        <p>Hen√ºz tarif kaydetmediniz</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">Yukarƒ±dan yeni tarif olu≈üturun!</p>
                    </div>
                `;
                return;
            }

            listDiv.innerHTML = recipes.map(recipe => `
                <div class="recipe-card">
                    <div class="recipe-header">
                        <div>
                            <div class="recipe-name">${recipe.name}</div>
                            <div class="recipe-servings">${recipe.servings} porsiyon</div>
                        </div>
                        <div class="recipe-actions">
                            <button class="icon-btn" onclick="viewRecipeDetails(${recipe.id})" title="Detaylar">
                                <i class="fas fa-info-circle"></i>
                            </button>
                            <button class="icon-btn delete" onclick="deleteRecipe(${recipe.id})" title="Sil">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    ${recipe.description ? `<p style="color: #666; font-size: 0.9rem; margin-bottom: 15px; line-height: 1.4;">${recipe.description}</p>` : ''}
                    
                    <div class="recipe-ingredients-count">
                        <i class="fas fa-list"></i> ${recipe.ingredients.length} malzeme
                    </div>
                    
                    <div class="recipe-nutrition">
                        <div class="recipe-nutrient">
                            <div class="nutrient-value">${recipe.nutrientsPerServing.calories}</div>
                            <div class="nutrient-label">Kalori</div>
                        </div>
                        <div class="recipe-nutrient">
                            <div class="nutrient-value">${recipe.nutrientsPerServing.protein}g</div>
                            <div class="nutrient-label">Protein</div>
                        </div>
                        <div class="recipe-nutrient">
                            <div class="nutrient-value">${recipe.nutrientsPerServing.carbs}g</div>
                            <div class="nutrient-label">Karbonhidrat</div>
                        </div>
                        <div class="recipe-nutrient">
                            <div class="nutrient-value">${recipe.nutrientsPerServing.fat}g</div>
                            <div class="nutrient-label">Yaƒü</div>
                        </div>
                    </div>
                    
                    <button class="recipe-add-btn" onclick="selectRecipeToAdd(${recipe.id})">
                        <i class="fas fa-plus-circle"></i> √ñƒü√ºne Ekle
                    </button>
                </div>
            `).join('');
        }

        // Tarif detaylarƒ±nƒ± g√∂ster
        function viewRecipeDetails(recipeId) {
            const recipes = JSON.parse(localStorage.getItem('nutritrack_recipes') || '[]');
            const recipe = recipes.find(r => r.id === recipeId);
            
            if (!recipe) return;

            const ingredientsList = recipe.ingredients.map(ing => 
                `‚Ä¢ ${ing.name} - ${ing.amount}g (${ing.nutrients.calories || 0} kcal)`
            ).join('\n');

            alert(`üìñ ${recipe.name}\n\n` +
                  `Porsiyon: ${recipe.servings}\n` +
                  `Kalori (porsiyon ba≈üƒ±na): ${recipe.nutrientsPerServing.calories} kcal\n\n` +
                  `Malzemeler:\n${ingredientsList}\n\n` +
                  (recipe.description ? `\n${recipe.description}` : '')
            );
        }

        // Tarif sil
        function deleteRecipe(recipeId) {
            if (!confirm('Bu tarifi silmek istediƒüinizden emin misiniz?')) return;

            let recipes = JSON.parse(localStorage.getItem('nutritrack_recipes') || '[]');
            recipes = recipes.filter(r => r.id !== recipeId);
            localStorage.setItem('nutritrack_recipes', JSON.stringify(recipes));

            showNotification('Tarif silindi');
            loadRecipes();
        }

        // Tarif ekleme i√ßin se√ß
        function selectRecipeToAdd(recipeId) {
            selectedRecipeForAdding = recipeId;
            document.getElementById('mealSelectModal').classList.add('active');
        }

        // Tarifi √∂ƒü√ºne ekle
        function addRecipeToMeal(mealType) {
            if (!selectedRecipeForAdding) return;

            const recipes = JSON.parse(localStorage.getItem('nutritrack_recipes') || '[]');
            const recipe = recipes.find(r => r.id === selectedRecipeForAdding);
            
            if (!recipe) return;

            // Bug√ºnk√º verileri al
            let todayData = JSON.parse(localStorage.getItem('nutritrack_today') || '{}');
            if (!todayData.foods) todayData.foods = [];
            if (!todayData.calories) todayData.calories = 0;

            // Tarifi besin olarak ekle
            const foodItem = {
                id: Date.now(),
                name: `${recipe.name} (Tarif)`,
                brand: `${recipe.servings} porsiyon tarif`,
                amount: recipe.servings * 100, // Temsili miktar
                calories: recipe.nutrientsPerServing.calories * recipe.servings,
                mealType: mealType,
                nutrients: {
                    calories: recipe.nutrientsPerServing.calories * recipe.servings,
                    protein: recipe.nutrientsPerServing.protein * recipe.servings,
                    carbs: recipe.nutrientsPerServing.carbs * recipe.servings,
                    fat: recipe.nutrientsPerServing.fat * recipe.servings,
                    ...recipe.micronutrientsPerServing
                },
                isRecipe: true,
                recipeId: recipe.id
            };

            todayData.foods.push(foodItem);
            todayData.calories += foodItem.calories;

            localStorage.setItem('nutritrack_today', JSON.stringify(todayData));

            // Ge√ßmi≈ü verilere de kaydet
            const today = new Date().toISOString().split('T')[0];
            let historyData = JSON.parse(localStorage.getItem('nutritrack_history') || '{}');
            
            if (!historyData[today]) {
                historyData[today] = { foods: [], calories: 0, water: todayData.water || 0 };
            }
            
            historyData[today].foods.push(foodItem);
            historyData[today].calories += foodItem.calories;
            
            localStorage.setItem('nutritrack_history', JSON.stringify(historyData));

            closeMealModal();
            showNotification(`"${recipe.name}" ${getMealName(mealType)}'e eklendi!`);
            
            // 2 saniye sonra nutrition sayfasƒ±na y√∂nlendir
            setTimeout(() => {
                window.location.href = 'nutrition.html';
            }, 2000);
        }

        // √ñƒü√ºn adƒ±nƒ± al
        function getMealName(mealType) {
            const names = {
                'breakfast': 'Kahvaltƒ±',
                'lunch': '√ñƒüle Yemeƒüi',
                'dinner': 'Ak≈üam Yemeƒüi',
                'snack': 'Ara √ñƒü√ºn'
            };
            return names[mealType] || '';
        }

        // Modal kapat
        function closeMealModal() {
            document.getElementById('mealSelectModal').classList.remove('active');
            selectedRecipeForAdding = null;
        }

        // Modal dƒ±≈üƒ±na tƒ±klanƒ±nca kapat
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('mealSelectModal');
            if (e.target === modal) {
                closeMealModal();
            }
        });

        // Bildirim g√∂ster
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            const bgColor = type === 'error' ? '#ff4757' : '#667eea';
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${bgColor};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 10000;
                animation: slideIn 0.3s ease;
                max-width: 300px;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Animasyon stilleri
        const recipeAnimStyle = document.createElement('style');
        recipeAnimStyle.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(recipeAnimStyle);

        // Tema y√∂netimi
        function initTheme() {
            const savedTheme = localStorage.getItem('nutritrack_theme') || 'light';
            setTheme(savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            setTheme(newTheme);
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('nutritrack_theme', theme);
            
            const themeIcon = document.getElementById('themeIcon');
            if (themeIcon) {
                themeIcon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            }
        }

        // Porsiyon deƒüi≈üince √∂zeti g√ºncelle
        document.getElementById('recipeServings').addEventListener('change', updateNutritionSummary);

        // Enter tu≈üu ile arama
        document.getElementById('ingredientSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchIngredient();
            }
        });

        // Sayfa y√ºklendiƒüinde
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            loadRecipes();
        });
    </script>
</body>
</html>

